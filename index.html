<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRU Data Network | Buy Data Bundles in Ghana - MTN, Telecel, AirtelTigo</title>
<meta name="description" content="Buy affordable data bundles in Ghana. Instant delivery for MTN, Telecel, and AirtelTigo. Secure Paystack payments. Data top up service across Ghana.">
<meta name="keywords" content="buy data Ghana, MTN data bundles, Telecel data, AirtelTigo data, cheap data Ghana, mobile data Ghana, internet bundles, data top up Ghana, TRU Data Network">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2637582768279029" crossorigin="anonymous"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://js.paystack.co/v1/inline.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap');

/* Enhanced Theme Variables */
:root {
  --bg-primary: #ffffff;
  --bg-secondary: #f1f5f9;
  --bg-tertiary: #e2e8f0;
  --bg-card: #ffffff;
  --bg-elevated: #ffffff;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-tertiary: #94a3b8;
  --accent-primary: #3b82f6;
  --accent-secondary: #8b5cf6;
  --accent-success: #10b981;
  --accent-warning: #f59e0b;
  --accent-danger: #ef4444;
  --border-color: #e2e8f0;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
  --shadow-glow: 0 0 40px -10px rgba(59, 130, 246, 0.5);
  --glass-bg: rgba(255, 255, 255, 0.8);
}

[data-theme="dark"] {
  --bg-primary: #0a0a0f;
  --bg-secondary: #12121a;
  --bg-tertiary: #1a1a25;
  --bg-card: #161622;
  --bg-elevated: #1e1e2e;
  --text-primary: #f8fafc;
  --text-secondary: #a1a1aa;
  --text-tertiary: #71717a;
  --accent-primary: #60a5fa;
  --accent-secondary: #a78bfa;
  --accent-success: #34d399;
  --accent-warning: #fbbf24;
  --accent-danger: #f87171;
  --border-color: #27273a;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.6);
  --shadow-glow: 0 0 60px -15px rgba(96, 165, 250, 0.4);
  --glass-bg: rgba(22, 22, 34, 0.85);
}

body { 
  font-family: 'Inter', 'Plus Jakarta Sans', sans-serif; 
  scroll-behavior: smooth; 
  overflow-x: hidden; 
  background-color: var(--bg-primary);
  color: var(--text-primary);
  transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1), color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  line-height: 1.6;
}

/* Glass Morphism */
.glass { 
  background: var(--glass-bg); 
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border-color);
}

.card-theme { 
  background-color: var(--bg-card); 
  border: 1px solid var(--border-color);
  box-shadow: var(--shadow-md);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.card-theme:hover {
  box-shadow: var(--shadow-xl);
  border-color: var(--accent-primary);
  transform: translateY(-4px);
}

.text-muted-theme { color: var(--text-secondary); }

/* Enhanced Network Cards */
.network-card { 
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.network-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 50% 0%, rgba(255,255,255,0.3), transparent 70%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.network-card:hover { 
  transform: translateY(-12px) scale(1.02); 
  box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
}

.network-card:hover::before {
  opacity: 1;
}

#admin-actions-bar { 
  display: none; 
  position: fixed; 
  bottom: 30px; 
  left: 50%; 
  transform: translateX(-50%); 
  z-index: 100; 
}

/* Enhanced WhatsApp Float */
.wa-float {
  position: fixed; 
  bottom: 30px; 
  right: 30px; 
  background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
  color: white;
  border-radius: 50%; 
  text-align: center; 
  font-size: 28px; 
  box-shadow: 0 10px 40px rgba(37, 211, 102, 0.4);
  z-index: 100; 
  width: 60px;
  height: 60px;
  display: flex; 
  align-items: center; 
  justify-content: center; 
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  animation: pulse-whatsapp 2s infinite;
}

.wa-float:hover { 
  transform: scale(1.1) rotate(10deg); 
  box-shadow: 0 15px 50px rgba(37, 211, 102, 0.6);
}

@keyframes pulse-whatsapp {
  0%, 100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
  70% { box-shadow: 0 0 0 20px rgba(37, 211, 102, 0); }
}

/* Modern Toggle Switch */
.theme-switch {
  position: relative; 
  width: 56px; 
  height: 28px;
  background: linear-gradient(135deg, #64748b 0%, #94a3b8 100%);
  border-radius: 50px; 
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

[data-theme="dark"] .theme-switch { 
  background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
}

.theme-circle {
  position: absolute; 
  top: 2px; 
  left: 2px; 
  width: 24px; 
  height: 24px;
  background: white; 
  border-radius: 50%; 
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
}

.theme-circle::before {
  content: '‚òÄÔ∏è';
  transition: all 0.3s ease;
}

[data-theme="dark"] .theme-circle { 
  left: 30px; 
  transform: rotate(360deg);
}

[data-theme="dark"] .theme-circle::before {
  content: 'üåô';
}

/* Advanced Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
  50% { box-shadow: 0 0 60px rgba(59, 130, 246, 0.8); }
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes slide-up {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes scale-in {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.animate-float { animation: float 6s ease-in-out infinite; }
.animate-pulse-glow { animation: pulse-glow 3s ease-in-out infinite; }
.animate-gradient { background-size: 200% 200%; animation: gradient-shift 8s ease infinite; }
.animate-slide-up { animation: slide-up 0.6s ease-out forwards; }
.animate-scale-in { animation: scale-in 0.5s ease-out forwards; }
.animate-shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); background-size: 200% 100%; animation: shimmer 2s infinite; }

.stagger-1 { animation-delay: 0.1s; }
.stagger-2 { animation-delay: 0.2s; }
.stagger-3 { animation-delay: 0.3s; }
.stagger-4 { animation-delay: 0.4s; }
.stagger-5 { animation-delay: 0.5s; }

/* Landing Page Enhanced Styles */
.hero-logo {
  max-width: 280px;
  filter: drop-shadow(0 25px 50px rgba(59, 130, 246, 0.3));
  transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.hero-logo:hover {
  transform: scale(1.08) rotate(3deg);
  filter: drop-shadow(0 35px 70px rgba(96, 165, 250, 0.5));
}

.gradient-text {
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  background-size: 200% 200%;
  animation: gradient-shift 5s ease infinite;
}

.feature-card {
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid var(--border-color);
  background: var(--bg-card);
}

.feature-card:hover {
  transform: translateY(-8px) scale(1.02);
  border-color: var(--accent-primary);
  box-shadow: var(--shadow-glow);
}

.cta-button {
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
  background-size: 200% 200%;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  border: none;
}

.cta-button::before {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.6s ease;
}

.cta-button:hover::before {
  left: 100%;
}

.cta-button:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: var(--shadow-glow);
}

/* Admin Dashboard Enhanced Styles */
.admin-btn {
  position: relative;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: none;
  cursor: pointer;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.admin-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(255,255,255,0.4) 0%, transparent 70%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.admin-btn:hover::after {
  opacity: 1;
}

.admin-btn:active {
  transform: scale(0.95);
}

.status-badge {
  position: relative;
  overflow: hidden;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 700;
  font-size: 0.65rem;
  letter-spacing: 0.05em;
}

.status-badge::before {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
  animation: shimmer 2.5s infinite;
}

.table-row {
  transition: all 0.3s ease;
  border-bottom: 1px solid var(--border-color);
}

.table-row:hover {
  background-color: rgba(59, 130, 246, 0.05);
  transform: scale(1.005);
}

.table-row:last-child {
  border-bottom: none;
}

/* Enhanced Dark Mode Glass */
.glass-enhanced {
  background: rgba(22, 22, 34, 0.95);
  backdrop-filter: blur(20px) saturate(200%);
  -webkit-backdrop-filter: blur(20px) saturate(200%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
}

[data-theme="light"] .glass-enhanced {
  background: rgba(255, 255, 255, 0.95);
  border: 1px solid rgba(59, 130, 246, 0.2);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

/* Input Enhancements */
input, select {
  background-color: var(--bg-tertiary);
  border: 2px solid transparent;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

input:focus, select:focus {
  border-color: var(--accent-primary);
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  outline: none;
  background-color: var(--bg-card);
}

[data-theme="dark"] input, [data-theme="dark"] select {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--text-tertiary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-primary);
}

/* Ad Container Styling */
.ad-container {
  background: var(--bg-secondary);
  border: 2px dashed var(--border-color);
  border-radius: 1rem;
  min-height: 100px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-tertiary);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Network Specific Gradients */
.network-mtn { background: linear-gradient(135deg, #FFCC00 0%, #FFD700 100%); color: #000; }
.network-airteltigo { background: linear-gradient(135deg, #0077B5 0%, #0099CC 100%); color: #fff; }
.network-telecel { background: linear-gradient(135deg, #E60000 0%, #FF0000 100%); color: #fff; }

/* Content Sections */
.content-section {
  padding: 4rem 1rem;
  max-width: 1200px;
  margin: 0 auto;
}

.section-title {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 1rem;
  background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Toast Notifications */
.toast {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--bg-card);
  color: var(--text-primary);
  padding: 1rem 2rem;
  border-radius: 1rem;
  box-shadow: var(--shadow-xl);
  border: 1px solid var(--border-color);
  z-index: 200;
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  font-weight: 600;
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* Loading Spinner */
.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top-color: currentColor;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Price Tag */
.price-tag {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.75rem;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: white;
  border-radius: 9999px;
  font-weight: 700;
  font-size: 0.875rem;
  box-shadow: 0 4px 15px -3px rgba(59, 130, 246, 0.4);
}

/* Responsive Improvements */
@media (max-width: 768px) {
  .hero-logo {
    max-width: 200px;
  }
  
  .section-title {
    font-size: 1.875rem;
  }
  
  .wa-float {
    width: 50px;
    height: 50px;
    font-size: 24px;
    bottom: 20px;
    right: 20px;
  }
}

/* Print Styles */
@media print {
  .wa-float, #admin-actions-bar, nav {
    display: none !important;
  }
}

/* Disclaimer Styling */
.disclaimer-box {
  background: linear-gradient(135deg, rgba(254, 252, 232, 0.9) 0%, rgba(254, 249, 195, 0.9) 100%);
  border-left: 4px solid #eab308;
  border-radius: 0.5rem;
  padding: 1rem;
  margin: 1rem 0;
  font-size: 0.875rem;
  color: #854d0e;
}

[data-theme="dark"] .disclaimer-box {
  background: linear-gradient(135deg, rgba(66, 32, 6, 0.9) 0%, rgba(113, 63, 18, 0.9) 100%);
  color: #fde047;
  border-left-color: #eab308;
}

.affiliate-disclosure {
  background: rgba(59, 130, 246, 0.1);
  border: 1px solid rgba(59, 130, 246, 0.3);
  border-radius: 0.75rem;
  padding: 1rem;
  margin: 1rem 0;
  font-size: 0.8rem;
  color: var(--text-secondary);
}

/* Admin Order Confirmation Modal Styles */
#admin-order-confirmation {
  display: none;
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 150;
  width: 90%;
  max-width: 500px;
}

.admin-confirmation-content {
  background: var(--bg-card);
  border: 2px solid var(--accent-primary);
  border-radius: 1.5rem;
  padding: 2rem;
  box-shadow: var(--shadow-xl), 0 0 40px rgba(59, 130, 246, 0.3);
  animation: slide-up 0.4s ease-out;
}

.admin-confirmation-header {
  text-align: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-color);
}

.admin-confirmation-title {
  font-size: 1.25rem;
  font-weight: 800;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.admin-confirmation-subtitle {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.admin-order-details {
  background: var(--bg-secondary);
  border-radius: 1rem;
  padding: 1rem;
  margin-bottom: 1.5rem;
}

.admin-order-detail-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  font-size: 0.875rem;
}

.admin-order-detail-row:last-child {
  margin-bottom: 0;
}

.admin-order-detail-label {
  color: var(--text-secondary);
  font-weight: 500;
}

.admin-order-detail-value {
  color: var(--text-primary);
  font-weight: 700;
}

.provider-selection {
  margin-bottom: 1.5rem;
}

.provider-selection-title {
  font-size: 0.875rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
  color: var(--text-primary);
  text-align: center;
}

.provider-buttons {
  display: flex;
  gap: 1rem;
}

.provider-btn {
  flex: 1;
  padding: 1rem;
  border: 2px solid var(--border-color);
  border-radius: 1rem;
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  font-weight: 700;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
}

.provider-btn:hover {
  border-color: var(--accent-primary);
  color: var(--accent-primary);
}

.provider-btn.selected {
  border-color: var(--accent-primary);
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: white;
}

.provider-btn svg {
  width: 24px;
  height: 24px;
}

.admin-confirmation-actions {
  display: flex;
  gap: 1rem;
}

.admin-confirmation-actions button {
  flex: 1;
  padding: 1rem;
  border-radius: 1rem;
  font-weight: 700;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
}

.btn-cancel-process {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
}

.btn-cancel-process:hover {
  background: var(--border-color);
}

.btn-confirm-process {
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: white;
}

.btn-confirm-process:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.4);
}

/* Express Mode Badge */
.express-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  animation: pulse-glow 2s infinite;
}

/* Mode Switcher Buttons */
.mode-switcher {
  display: flex;
  gap: 0.5rem;
  background: var(--bg-tertiary);
  padding: 0.25rem;
  border-radius: 1rem;
}

.mode-btn {
  padding: 0.5rem 1rem;
  border-radius: 0.75rem;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  background: transparent;
  color: var(--text-secondary);
}

.mode-btn.active {
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: white;
  box-shadow: var(--shadow-md);
}

.mode-btn:hover:not(.active) {
  background: var(--bg-card);
  color: var(--text-primary);
}

/* Wallet Styles */
.wallet-card {
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: white;
  border-radius: 1.5rem;
  padding: 1.5rem;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-xl);
}

.wallet-card::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
  transform: rotate(45deg);
}

.wallet-balance {
  font-size: 2.5rem;
  font-weight: 800;
  position: relative;
  z-index: 1;
}

.wallet-label {
  font-size: 0.875rem;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  position: relative;
  z-index: 1;
}

.deposit-fee-note {
  font-size: 0.75rem;
  color: var(--text-tertiary);
  margin-top: 0.5rem;
}

/* View Wallet Button Fix */
.view-wallet-btn {
  background: rgba(255, 255, 255, 0.9);
  color: var(--accent-primary);
  border: 2px solid rgba(255, 255, 255, 0.5);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  position: relative;
  z-index: 10;
  cursor: pointer;
  pointer-events: auto;
}

.view-wallet-btn:hover {
  background: white;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
  border-color: white;
}

[data-theme="dark"] .view-wallet-btn {
  background: rgba(30, 30, 46, 0.9);
  color: white;
  border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .view-wallet-btn:hover {
  background: rgba(30, 30, 46, 1);
  border-color: rgba(255, 255, 255, 0.4);
}

/* Loading State */
.loading-shimmer {
  background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-secondary) 50%, var(--bg-tertiary) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 0.5rem;
}

.error-message {
  color: var(--accent-danger);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: rgba(239, 68, 68, 0.1);
  border-radius: 0.5rem;
  border-left: 3px solid var(--accent-danger);
}
</style>
</head>

<body class="min-h-screen flex flex-col antialiased">

<nav class="sticky top-0 z-[60] glass transition-all duration-300">
  <div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
    <div onclick="navigateTo('landing')" class="text-2xl font-extrabold tracking-tighter cursor-pointer flex items-center gap-2 hover:scale-105 transition-transform duration-300">
      <span class="bg-gradient-to-br from-blue-500 to-purple-600 text-white px-3 py-1.5 rounded-xl italic shadow-lg">TRU</span> 
      <span class="dark:text-white font-bold">DATA</span>
    </div>
    
    <div class="flex gap-4 md:gap-8 items-center">
      <div class="flex items-center gap-2 mr-4">
        <span class="text-[10px] font-bold uppercase hidden sm:block text-muted-theme">Theme</span>
        <div class="theme-switch" onclick="toggleTheme()" role="button" aria-label="Toggle dark mode">
          <div class="theme-circle"></div>
        </div>
      </div>
      
      <button onclick="navigateTo('home')" class="font-semibold text-sm hover:text-blue-600 dark:hover:text-blue-400 hidden md:block transition-colors duration-300">Buy Data</button>
      <button onclick="navigateTo('about')" class="font-semibold text-sm hover:text-blue-600 dark:hover:text-blue-400 hidden md:block transition-colors duration-300">About</button>
      
      <!-- User Auth Section -->
      <div id="user-auth-section" class="hidden md:flex items-center gap-3">
        <!-- Populated by JS -->
      </div>
      
      <button id="admin-nav-btn" class="text-[10px] bg-slate-100 dark:bg-slate-800 px-4 py-2.5 rounded-full font-bold text-slate-500 hover:bg-blue-600 hover:text-white transition-all uppercase shadow-md hover:shadow-lg transform hover:-translate-y-0.5">Admin</button>
    </div>
  </div>
</nav>

<main id="app-view" class="flex-grow"></main>

<div id="extended-content"></div>

<!-- Toast Notification Container -->
<div id="toast-container"></div>

<!-- Admin Order Confirmation Modal -->
<div id="admin-order-confirmation">
  <div class="admin-confirmation-content">
    <div class="admin-confirmation-header">
      <div class="admin-confirmation-title">Process Order</div>
      <div class="admin-confirmation-subtitle">Select a provider to fulfill this order</div>
    </div>
    
    <div class="admin-order-details">
      <div class="admin-order-detail-row">
        <span class="admin-order-detail-label">Phone Number:</span>
        <span class="admin-order-detail-value" id="confirm-phone"></span>
      </div>
      <div class="admin-order-detail-row">
        <span class="admin-order-detail-label">Network:</span>
        <span class="admin-order-detail-value" id="confirm-network"></span>
      </div>
      <div class="admin-order-detail-row">
        <span class="admin-order-detail-label">Bundle:</span>
        <span class="admin-order-detail-value" id="confirm-bundle"></span>
      </div>
      <div class="admin-order-detail-row">
        <span class="admin-order-detail-label">Amount:</span>
        <span class="admin-order-detail-value" id="confirm-amount"></span>
      </div>
    </div>
    
    <div class="provider-selection">
      <div class="provider-selection-title">Choose Provider Platform</div>
      <div class="provider-buttons">
        <button class="provider-btn" id="btn-evnetwork-confirm" onclick="selectConfirmationProvider('evnetwork')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
          EV Network
        </button>
        <button class="provider-btn" id="btn-refer2bundle-confirm" onclick="selectConfirmationProvider('refer2bundle')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
          Refer2Bundle
        </button>
      </div>
    </div>
    
    <div class="admin-confirmation-actions">
      <button class="btn-cancel-process" onclick="closeAdminConfirmation()">Cancel</button>
      <button class="btn-confirm-process" onclick="confirmProcessOrder()">Process Order</button>
    </div>
  </div>
</div>

<footer class="py-16 text-center border-t border-slate-200 dark:border-slate-800 bg-gradient-to-t from-slate-50 to-transparent dark:from-slate-900 dark:to-transparent">
  <div class="max-w-4xl mx-auto px-4">
    <div class="mb-8">
      <span class="text-2xl font-extrabold tracking-tighter inline-flex items-center gap-2">
        <span class="bg-gradient-to-br from-blue-500 to-purple-600 text-white px-3 py-1.5 rounded-xl italic shadow-lg">TRU</span> 
        <span class="dark:text-white">DATA</span>
      </span>
    </div>
    
    <div class="grid md:grid-cols-3 gap-8 mb-8 text-left">
      <div>
        <h4 class="font-bold mb-4 text-sm uppercase tracking-wider">Quick Links</h4>
        <ul class="space-y-2 text-sm text-muted-theme">
          <li><button onclick="navigateTo('landing')" class="hover:text-blue-600 transition-colors">Home</button></li>
          <li><button onclick="navigateTo('home')" class="hover:text-blue-600 transition-colors">Buy Data</button></li>
          <li><button onclick="navigateTo('about')" class="hover:text-blue-600 transition-colors">About Us</button></li>
        </ul>
      </div>
      <div>
        <h4 class="font-bold mb-4 text-sm uppercase tracking-wider">Networks</h4>
        <ul class="space-y-2 text-sm text-muted-theme">
          <li><button onclick="navigateTo('network','mtn')" class="hover:text-blue-600 transition-colors">MTN Ghana</button></li>
          <li><button onclick="navigateTo('network','telecel')" class="hover:text-blue-600 transition-colors">Telecel</button></li>
          <li><button onclick="navigateTo('network','airteltigo')" class="hover:text-blue-600 transition-colors">AirtelTigo</button></li>
        </ul>
      </div>
      <div>
        <h4 class="font-bold mb-4 text-sm uppercase tracking-wider">Contact</h4>
        <ul class="space-y-2 text-sm text-muted-theme">
          <li>WhatsApp: +233 59 757 8538</li>
          <li>Email: support@trudata.com</li>
          <li>Accra, Ghana</li>
        </ul>
      </div>
    </div>
    
    <div class="border-t border-slate-200 dark:border-slate-800 pt-8">
      <p class="text-slate-400 font-semibold text-xs uppercase tracking-widest mb-2">TRU Data is an independent digital service by TRUTECH BUSINESS.</p>
      <p class="text-slate-400 font-semibold text-xs uppercase tracking-widest mb-2">Not affiliated with MTN, Telecel, or AirtelTigo.</p>
      <p class="text-slate-500 font-bold text-xs mt-4">¬© 2026 TRU DATA. All rights reserved.</p>
    </div>
  </div>
</footer>

<div id="admin-actions-bar" class="w-[90%] max-w-lg glass-enhanced text-white p-5 rounded-2xl shadow-2xl flex flex-col gap-4 border animate__animated animate__slideInUp">
  <div class="flex flex-col">
    <span class="text-[10px] font-black uppercase text-blue-400 tracking-widest mb-1">Active Processing</span>
    <span id="active-order-label" class="text-sm font-bold truncate max-w-[250px] text-slate-900 dark:text-white"></span>
  </div>
  
  <div class="affiliate-disclosure">
    <p class="text-xs font-semibold mb-2">Select Provider for Direct Order:</p>
    <div class="flex gap-2 mb-2">
      <button onclick="selectProvider('evnetwork')" id="btn-evnetwork" class="flex-1 py-2 px-3 rounded-lg bg-blue-600 text-white text-xs font-bold transition-all">EV Network</button>
      <button onclick="selectProvider('refer2bundle')" id="btn-refer2bundle" class="flex-1 py-2 px-3 rounded-lg bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-xs font-bold transition-all">Refer2Bundle</button>
    </div>
    <p class="text-[10px] opacity-75">You will be redirected to complete the order on the selected platform.</p>
  </div>
  
  <div class="flex gap-3 justify-end">
    <button onclick="cancelActiveProcess()" class="admin-btn px-4 py-2.5 text-[11px] font-bold bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-xl hover:bg-slate-300 dark:hover:bg-slate-600 transition-all">
      Dismiss
    </button>
    <button id="global-fulfill-btn" class="admin-btn px-5 py-2.5 text-[11px] font-black bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl shadow-lg hover:shadow-green-500/30 transition-all text-white">
      ‚úì Confirm & Fulfill
    </button>
  </div>
</div>

<a href="https://wa.me/233597578538" class="wa-float" target="_blank" rel="noopener noreferrer" aria-label="Contact us on WhatsApp">
  <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12.031 6.172c-2.32 0-4.519.903-6.16 2.544-1.64 1.64-2.543 3.838-2.543 6.158 0 1.61.439 3.191 1.272 4.578L3.375 23l3.818-1.226c1.328.724 2.822 1.107 4.337 1.107l.001-.001c2.32 0 4.52-.903 6.161-2.544 1.64-1.64 2.544-3.838 2.544-6.159 0-2.32-.904-4.518-2.544-6.159-1.64-1.641-3.839-2.545-6.161-2.545zm5.035 11.031c-.193.543-1.137 1.032-1.571 1.096-.434.064-.91.133-2.736-.605-2.203-.891-3.626-3.134-3.737-3.282-.11-.148-.891-1.185-.891-2.26s.555-1.604.752-1.821c.198-.217.433-.271.577-.271.145 0 .289.001.416.007.133.006.312-.05.488.372.181.434.619 1.506.674 1.617.054.111.091.241.016.39-.075.148-.112.241-.223.37-.111.148-.112.241-.223.37-.111.13-.233.29-.333.388-.111.111-.227.232-.097.455.13.223.578 1.019 1.241 1.604.854.753 1.572 1.018 1.795 1.13.223.111.353.093.483-.056.13-.149.555-.65.703-.872.148-.222.297-.186.5-.111.204.074 1.297.611 1.519.722.222.112.37.167.426.26.055.092.055.536-.138 1.079z"/></svg>
</a>

<script>
/* ================= THEME LOGIC ================= */
function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  const target = current === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', target);
  localStorage.setItem('tru-theme', target);
  showToast(`${target === 'dark' ? 'üåô' : '‚òÄÔ∏è'} ${target.charAt(0).toUpperCase() + target.slice(1)} mode activated`);
}

// Load saved theme
const savedTheme = localStorage.getItem('tru-theme');
if (savedTheme) {
  document.documentElement.setAttribute('data-theme', savedTheme);
} else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.documentElement.setAttribute('data-theme', 'dark');
}

/* ================= CONFIG ================= */
const SB_URL = "https://kefcmjfvrqbgtivssdwn.supabase.co";
const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlZmNtamZ2cnFiZ3RpdnNzZHduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2MDM1NTIsImV4cCI6MjA4NDE3OTU1Mn0.HoXeKRW4-cGfMexGZpdmEvDHK-XXtXDSoMWWWbq4HKw";
const PAYSTACK_KEY = "pk_live_ea1b78f7fb20ea947f216c78e6ae3adc32d45f1b";
const supa = supabase.createClient(SB_URL, SB_KEY);

const NETWORKS = {
  mtn:{name:'MTN Ghana',color:'bg-[#FFCC00]',text:'text-black',logo:'./2.png', description: 'Ghana\'s largest network with widest coverage'},
  airteltigo:{name:'AirtelTigo',color:'bg-[#0077B5]',text:'text-white',logo:'./3.png', description: 'Affordable data plans with great value'},
  telecel:{name:'Telecel',color:'bg-[#E60000]',text:'text-white',logo:'./4.png', description: 'Fast 4G internet at competitive prices'}
};

// Normal Bundles (available all day)
const NORMAL_BUNDLES = [
  // MTN Bundles
  {id:'m-1',network:'mtn',size:'1GB',price:5.40, validity:'30 Days'}, 
  {id:'m-2',network:'mtn',size:'2GB',price:10.00, validity:'30 Days'},
  {id:'m-3',network:'mtn',size:'3GB',price:15.00, validity:'30 Days'}, 
  {id:'m-4',network:'mtn',size:'4GB',price:19.50, validity:'30 Days'},
  {id:'m-5',network:'mtn',size:'5GB',price:23.50, validity:'30 Days'}, 
  {id:'m-6',network:'mtn',size:'6GB',price:27.00, validity:'30 Days'},
  {id:'m-7',network:'mtn',size:'7GB',price:32.00, validity:'30 Days'},
  {id:'m-8',network:'mtn',size:'8GB',price:37.50, validity:'30 Days'}, 
  {id:'m-10',network:'mtn',size:'10GB',price:44.80, validity:'30 Days'},
  {id:'m-12',network:'mtn',size:'12GB',price:55.50, validity:'30 Days'},
  {id:'m-15',network:'mtn',size:'15GB',price:64.00, validity:'30 Days'}, 
  {id:'m-20',network:'mtn',size:'20GB',price:82.00, validity:'30 Days'},
  {id:'m-25',network:'mtn',size:'25GB',price:102.90, validity:'30 Days'}, 
  {id:'m-30',network:'mtn',size:'30GB',price:130.00, validity:'30 Days'},
  {id:'m-40',network:'mtn',size:'40GB',price:163.50, validity:'30 Days'}, 
  {id:'m-50',network:'mtn',size:'50GB',price:193.90, validity:'30 Days'},
  {id:'m-100',network:'mtn',size:'100GB',price:386.90, validity:'30 Days'},
  
  // AirtelTigo Bundles
  {id:'a-1',network:'airteltigo',size:'1GB',price:6.50, validity:'30 Days'}, 
  {id:'a-2',network:'airteltigo',size:'2GB',price:11.00, validity:'30 Days'},
  {id:'a-3',network:'airteltigo',size:'3GB',price:15.50, validity:'30 Days'}, 
  {id:'a-4',network:'airteltigo',size:'4GB',price:20.50, validity:'30 Days'},
  {id:'a-5',network:'airteltigo',size:'5GB',price:23.50, validity:'30 Days'},
  {id:'a-6',network:'airteltigo',size:'6GB',price:27.00, validity:'30 Days'},
  {id:'a-7',network:'airteltigo',size:'7GB',price:32.00, validity:'30 Days'},
  {id:'a-8',network:'airteltigo',size:'8GB',price:34.50, validity:'30 Days'},
  {id:'a-10',network:'airteltigo',size:'10GB',price:42.50, validity:'30 Days'},
  {id:'a-15',network:'airteltigo',size:'15GB',price:64.00, validity:'30 Days'},
  {id:'a-20',network:'airteltigo',size:'20GB',price:82.00, validity:'30 Days'},
  {id:'a-25',network:'airteltigo',size:'25GB',price:99.90, validity:'30 Days'},
  {id:'a-30',network:'airteltigo',size:'30GB',price:118.70, validity:'30 Days'},
  {id:'a-40',network:'airteltigo',size:'40GB',price:163.50, validity:'30 Days'},
  {id:'a-50',network:'airteltigo',size:'50GB',price:199.90, validity:'30 Days'},
  
  // Telecel Bundles
  {id:'t-10',network:'telecel',size:'10GB',price:40.00, validity:'30 Days'},
  {id:'t-15',network:'telecel',size:'15GB',price:58.00, validity:'30 Days'},
  {id:'t-20',network:'telecel',size:'20GB',price:78.00, validity:'30 Days'},
  {id:'t-25',network:'telecel',size:'25GB',price:99.00, validity:'30 Days'},
  {id:'t-30',network:'telecel',size:'30GB',price:113.00, validity:'30 Days'},
  {id:'t-40',network:'telecel',size:'40GB',price:148.00, validity:'30 Days'},
  {id:'t-50',network:'telecel',size:'50GB',price:183.00, validity:'30 Days'},
  {id:'t-100',network:'telecel',size:'100GB',price:369.00, validity:'30 Days'}
];

// Express Bundles (available 9:00pm to 6:00am)
const EXPRESS_BUNDLES = [
  // MTN Express Bundles
  {id:'m-1',network:'mtn',size:'1GB',price:7, validity:'30 Days'},
  {id:'m-2',network:'mtn',size:'2GB',price:12, validity:'30 Days'},
  {id:'m-3',network:'mtn',size:'3GB',price:17, validity:'30 Days'},
  {id:'m-4',network:'mtn',size:'4GB',price:22, validity:'30 Days'},
  {id:'m-5',network:'mtn',size:'5GB',price:27, validity:'30 Days'},
  {id:'m-6',network:'mtn',size:'6GB',price:32, validity:'30 Days'},
  {id:'m-8',network:'mtn',size:'8GB',price:40, validity:'30 Days'},
  {id:'m-10',network:'mtn',size:'10GB',price:52, validity:'30 Days'},
  {id:'m-15',network:'mtn',size:'15GB',price:70, validity:'30 Days'},
  {id:'m-20',network:'mtn',size:'20GB',price:93, validity:'30 Days'},
  {id:'m-25',network:'mtn',size:'25GB',price:117, validity:'30 Days'},
  {id:'m-30',network:'mtn',size:'30GB',price:138, validity:'30 Days'},
  {id:'m-40',network:'mtn',size:'40GB',price:179, validity:'30 Days'},
  {id:'m-50',network:'mtn',size:'50GB',price:225, validity:'30 Days'},
  
  // AirtelTigo Express Bundles
  {id:'a-1',network:'airteltigo',size:'1GB',price:7, validity:'30 Days'},
  {id:'a-2',network:'airteltigo',size:'2GB',price:12, validity:'30 Days'},
  {id:'a-3',network:'airteltigo',size:'3GB',price:17, validity:'30 Days'},
  {id:'a-4',network:'airteltigo',size:'4GB',price:22, validity:'30 Days'},
  {id:'a-5',network:'airteltigo',size:'5GB',price:27, validity:'30 Days'},
  
  // Telecel Express Bundles
  {id:'t-5',network:'telecel',size:'5GB',price:27, validity:'30 Days'},
  {id:'t-10',network:'telecel',size:'10GB',price:42, validity:'30 Days'},
  {id:'t-20',network:'telecel',size:'20GB',price:76, validity:'30 Days'},
  {id:'t-25',network:'telecel',size:'25GB',price:93, validity:'30 Days'},
  {id:'t-30',network:'telecel',size:'30GB',price:120, validity:'30 Days'},
  {id:'t-40',network:'telecel',size:'40GB',price:183, validity:'30 Days'},
  {id:'t-50',network:'telecel',size:'50GB',price:190, validity:'30 Days'},
  {id:'t-100',network:'telecel',size:'100GB',price:365, validity:'30 Days'}
];

let state={
  view:'landing',
  isAdmin:false,
  isDirectMode:false,
  orders:[],
  searchQuery:'',
  networkFilter:'all',
  activeOrderData:null,
  selectedProvider:'evnetwork',
  currentProcessingOrder:null,
  confirmationSelectedProvider:'evnetwork',
  isExpressMode:false,
  expressOverride:null,
  // User Auth State
  user: null,
  userProfile: null,
  depositAmount: '',
  isLoading: false,
  connectionError: null
};

/* ================== UTILITY FUNCTIONS ================== */
function showToast(message, duration = 3000, type = 'info') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast';
  if (type === 'error') {
    toast.style.borderLeft = '4px solid #ef4444';
  } else if (type === 'success') {
    toast.style.borderLeft = '4px solid #10b981';
  }
  toast.textContent = message;
  container.appendChild(toast);
  
  setTimeout(() => toast.classList.add('show'), 10);
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 400);
  }, duration);
}

function selectProvider(provider) {
  state.selectedProvider = provider;
  document.getElementById('btn-evnetwork').className = provider === 'evnetwork' 
    ? 'flex-1 py-2 px-3 rounded-lg bg-blue-600 text-white text-xs font-bold transition-all'
    : 'flex-1 py-2 px-3 rounded-lg bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-xs font-bold transition-all';
  document.getElementById('btn-refer2bundle').className = provider === 'refer2bundle'
    ? 'flex-1 py-2 px-3 rounded-lg bg-blue-600 text-white text-xs font-bold transition-all'
    : 'flex-1 py-2 px-3 rounded-lg bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-xs font-bold transition-all';
}

function selectConfirmationProvider(provider) {
  state.confirmationSelectedProvider = provider;
  document.getElementById('btn-evnetwork-confirm').classList.toggle('selected', provider === 'evnetwork');
  document.getElementById('btn-refer2bundle-confirm').classList.toggle('selected', provider === 'refer2bundle');
}

function closeAdminConfirmation() {
  document.getElementById('admin-order-confirmation').style.display = 'none';
  state.currentProcessingOrder = null;
}

function confirmProcessOrder() {
  if (!state.currentProcessingOrder) return;
  
  const order = state.currentProcessingOrder;
  const provider = state.confirmationSelectedProvider;
  const providerUrl = provider === 'evnetwork' ? 'https://evnetwork.shop' : 'https://refer2bundle.com';
  
  // Update order status
  updateStatus(order.ref, 'Processing');
  
  // Open provider in new tab
  window.open(providerUrl, '_blank');
  
  closeAdminConfirmation();
  showToast('‚úÖ Order marked as Processing. Redirecting...');
}

/* ================== TIME CHECKING FOR EXPRESS MODE ================== */
function checkExpressHours() {
  const now = new Date();
  const hour = now.getHours();
  // Express mode: 9:00 PM (21:00) to 6:00 AM (06:00)
  // Outside this range is normal mode
  return hour >= 21 || hour < 6;
}

function getCurrentBundles() {
  // If admin has manually overridden, use that
  if (state.expressOverride !== null) {
    return state.expressOverride ? EXPRESS_BUNDLES : NORMAL_BUNDLES;
  }
  // Otherwise use time-based logic
  return checkExpressHours() ? EXPRESS_BUNDLES : NORMAL_BUNDLES;
}

function isCurrentlyExpress() {
  if (state.expressOverride !== null) {
    return state.expressOverride;
  }
  return checkExpressHours();
}

function switchToExpress() {
  state.expressOverride = true;
  showToast('üåô Switched to Express Mode');
  render();
}

function switchToNormal() {
  state.expressOverride = false;
  showToast('‚òÄÔ∏è Switched to Normal Mode');
  render();
}

function resetToAutoMode() {
  state.expressOverride = null;
  showToast('üîÑ Reset to Auto Mode (Time-based)');
  render();
}

/* ================== PHONE VALIDATION ================== */
function validateGhanaPhone(phone) {
  // Remove any spaces or dashes
  phone = phone.replace(/[\s-]/g, '');
  
  // Check if it starts with valid Ghana prefixes
  const validPrefixes = ['024', '054', '055', '059', '027', '057', '026', '056', '020', '050', '023', '053', '028', '058'];
  const startsWithValidPrefix = validPrefixes.some(prefix => phone.startsWith(prefix));
  
  // Must be exactly 10 digits
  const isCorrectLength = phone.length === 10;
  
  // Must contain only digits
  const isOnlyDigits = /^\d+$/.test(phone);
  
  return {
    isValid: startsWithValidPrefix && isCorrectLength && isOnlyDigits,
    error: !isOnlyDigits ? 'Phone number must contain only digits' :
           !startsWithValidPrefix ? 'Phone number must start with a valid Ghana prefix (024, 054, 055, etc.)' :
           !isCorrectLength ? 'Phone number must be exactly 10 digits' : null
  };
}

/* ================== CORE FUNCTIONS ================== */
async function navigateTo(view,params=null){
  try {
    state.view=view;
    state.params=params;
    if(view==='admin-dashboard') await fetchOrders();
    if(view==='wallet') await fetchUserProfile();
    render();
    window.scrollTo(0,0);
  } catch (err) {
    console.error('Navigation error:', err);
    showToast('‚ùå Error loading page. Please try again.', 3000, 'error');
  }
}

function updateAuthUI() {
  const authSection = document.getElementById('user-auth-section');
  if (!authSection) return;
  
  if (state.user) {
    authSection.innerHTML = `
      <div class="flex items-center gap-3">
        <button onclick="navigateTo('wallet')" class="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded-full text-xs font-bold hover:shadow-lg transition-all">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
          Wallet
        </button>
        <button onclick="logoutUser()" class="text-xs font-bold text-slate-500 hover:text-red-500 transition-colors">
          Logout
        </button>
      </div>
    `;
  } else {
    authSection.innerHTML = `
      <div class="flex items-center gap-2">
        <button onclick="navigateTo('login')" class="text-xs font-bold text-slate-600 dark:text-slate-300 hover:text-blue-600 transition-colors">Login</button>
        <span class="text-slate-300">|</span>
        <button onclick="navigateTo('register')" class="text-xs font-bold bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition-colors">Sign Up</button>
      </div>
    `;
  }
}

function renderExtendedContent() {
    if(state.view !== 'home' && state.view !== 'network' && state.view !== 'landing') {
        return "";
    }
    
    return `
    <!-- AdSense Policy Compliant Content Section -->
    <section class="max-w-7xl mx-auto px-6 py-16 border-t border-slate-200 dark:border-slate-800">
      <div class="disclaimer-box mb-8">
        <strong>Important Notice:</strong> TRU Data is an independent platform that facilitates data bundle purchases. We are not directly affiliated with MTN, Telecel, or AirtelTigo. All network names and logos are trademarks of their respective owners. Prices and availability are subject to change based on network provider policies.
      </div>
      
      <div class="grid md:grid-cols-3 gap-8 mb-16">
        <div class="p-6 card-theme rounded-2xl animate-slide-up">
          <h3 class="text-xl font-bold mb-3 text-blue-600">Why Choose TRU Data?</h3>
          <p class="text-sm text-muted-theme leading-relaxed">
            TRU Data Network provides competitive data bundle prices in Ghana. We partner with authorized vendors to bring you convenient access to data packages, secure payment processing through Paystack, and customer support.
          </p>
        </div>
        <div class="p-6 card-theme rounded-2xl animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
          <h3 class="text-xl font-bold mb-3 text-purple-600">Coverage Across Ghana</h3>
          <p class="text-sm text-muted-theme leading-relaxed">
            Our service is available nationwide. Whether you're in Accra, Kumasi, Tamale, Cape Coast, or anywhere in Ghana, you can purchase data bundles through our platform.
          </p>
        </div>
        <div class="p-6 card-theme rounded-2xl animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
          <h3 class="text-xl font-bold mb-3 text-green-600">Secure & Trusted</h3>
          <p class="text-sm text-muted-theme leading-relaxed">
            Your payments are processed securely through Paystack. We do not store your mobile money PIN or card details. All transactions are encrypted for your protection.
          </p>
        </div>
      </div>
    </section>

    <section class="max-w-7xl mx-auto px-6 py-20 border-t border-slate-200 dark:border-slate-800">
        <div class="grid md:grid-cols-2 gap-16 items-center">
            <div>
                <h2 class="text-3xl font-black mb-6 animate-slide-up">How It Works</h2>
                <div class="space-y-6">
                    <div class="flex gap-4 animate-slide-up stagger-1 opacity-0" style="animation-fill-mode: forwards;">
                        <div class="h-12 w-12 shrink-0 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl flex items-center justify-center font-bold shadow-lg shadow-blue-500/30 text-lg">1</div>
                        <div>
                            <h4 class="font-bold text-lg mb-1">Create Account</h4>
                            <p class="text-muted-theme text-sm">Sign up for a free TRU Data account to access our services and manage your wallet.</p>
                        </div>
                    </div>
                    <div class="flex gap-4 animate-slide-up stagger-2 opacity-0" style="animation-fill-mode: forwards;">
                        <div class="h-12 w-12 shrink-0 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl flex items-center justify-center font-bold shadow-lg shadow-blue-500/30 text-lg">2</div>
                        <div>
                            <h4 class="font-bold text-lg mb-1">Deposit Funds</h4>
                            <p class="text-muted-theme text-sm">Add money to your TRU Wallet using Paystack. Funds are credited instantly to your wallet.</p>
                        </div>
                    </div>
                    <div class="flex gap-4 animate-slide-up stagger-3 opacity-0" style="animation-fill-mode: forwards;">
                        <div class="h-12 w-12 shrink-0 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl flex items-center justify-center font-bold shadow-lg shadow-blue-500/30 text-lg">3</div>
                        <div>
                            <h4 class="font-bold text-lg mb-1">Buy Data Instantly</h4>
                            <p class="text-muted-theme text-sm">Select your network and bundle, then pay seamlessly from your wallet balance.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-slate-100 dark:bg-slate-800/50 p-8 rounded-[2.5rem] animate-scale-in shadow-2xl border border-slate-200 dark:border-slate-700">
                <h2 class="text-3xl font-black mb-6">Service Features</h2>
                <ul class="space-y-4">
                    <li class="flex items-center gap-3 font-bold p-3 rounded-xl hover:bg-white dark:hover:bg-slate-700 transition-colors cursor-default group">
                        <svg class="w-6 h-6 text-green-500 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg> 
                        Wallet-Based Purchasing
                    </li>
                    <li class="flex items-center gap-3 font-bold p-3 rounded-xl hover:bg-white dark:hover:bg-slate-700 transition-colors cursor-default group">
                        <svg class="w-6 h-6 text-green-500 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg> 
                        Verified Paystack Integration
                    </li>
                    <li class="flex items-center gap-3 font-bold p-3 rounded-xl hover:bg-white dark:hover:bg-slate-700 transition-colors cursor-default group">
                        <svg class="w-6 h-6 text-green-500 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg> 
                        No Hidden Charges
                    </li>
                    <li class="flex items-center gap-3 font-bold p-3 rounded-xl hover:bg-white dark:hover:bg-slate-700 transition-colors cursor-default group">
                        <svg class="w-6 h-6 text-green-500 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg> 
                        Customer Support Available
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Ad Container -->
    <div class="max-w-5xl mx-auto px-6 my-12">
      <div class="ad-container">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2637582768279029"
             data-ad-slot="5392404731"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
    </div>

    <section class="bg-gradient-to-br from-blue-600 via-purple-600 to-blue-700 animate-gradient py-20 text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'0.05\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z\' fill=\'%23ffffff\' fill-opacity=\'0.05\' fill-rule=\'evenodd\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>
        <div class="max-w-5xl mx-auto px-6 text-center relative z-10">
            <h2 class="text-4xl font-black mb-6 animate-slide-up">Your Reliable Data Top-up Service</h2>
            <p class="text-xl opacity-90 mb-10 leading-relaxed max-w-3xl mx-auto animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
                TRU Data Network helps Ghanaians stay connected with convenient access to data bundles. Whether for remote work in Accra, streaming in Kumasi, online learning in Tamale, or social media across Ghana, we aim to make data purchases simple and accessible.
            </p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div class="animate-scale-in stagger-1 bg-white/10 backdrop-blur-sm rounded-2xl p-4" style="animation-fill-mode: forwards;">
                    <h3 class="text-4xl font-black mb-1">24/7</h3>
                    <p class="text-xs uppercase font-bold opacity-80">Online Service</p>
                </div>
                <div class="animate-scale-in stagger-2 bg-white/10 backdrop-blur-sm rounded-2xl p-4" style="animation-fill-mode: forwards;">
                    <h3 class="text-4xl font-black mb-1">Fast</h3>
                    <p class="text-xs uppercase font-bold opacity-80">Processing</p>
                </div>
                <div class="animate-scale-in stagger-3 bg-white/10 backdrop-blur-sm rounded-2xl p-4" style="animation-fill-mode: forwards;">
                    <h3 class="text-4xl font-black mb-1">Secure</h3>
                    <p class="text-xs uppercase font-bold opacity-80">Payments</p>
                </div>
                <div class="animate-scale-in stagger-4 bg-white/10 backdrop-blur-sm rounded-2xl p-4" style="animation-fill-mode: forwards;">
                    <h3 class="text-4xl font-black mb-1">Support</h3>
                    <p class="text-xs uppercase font-bold opacity-80">Available</p>
                </div>
            </div>
        </div>
    </section>

    <!-- SEO Rich Content -->
    <section class="max-w-4xl mx-auto px-6 py-20">
        <article class="prose prose-slate dark:prose-invert max-w-none">
            <h2 class="text-3xl font-black mb-6 text-center animate-slide-up">Understanding Mobile Data in Ghana</h2>
            
            <div class="disclaimer-box mb-8">
              <strong>Disclaimer:</strong> The following information is for educational purposes only. Network coverage, speeds, and availability may vary by location. Please verify current offerings directly with your service provider.
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 text-sm text-muted-theme leading-relaxed">
                <div class="animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-3">MTN Ghana Data Services</h3>
                    <p class="mb-4">
                        MTN is one of Ghana's largest telecommunications networks, offering extensive coverage across the country. MTN data bundles range from 1GB to 100GB, catering to various user needs. MTN's 4G+ network provides internet speeds suitable for video conferencing, streaming, and file downloads.
                    </p>
                </div>
                <div class="animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-3">Telecel Data Services</h3>
                    <p class="mb-4">
                        Telecel (formerly Vodafone Ghana) offers data packages with various options. Their 4G network covers major cities including Accra, Tema, Kumasi, and Takoradi. Telecel provides different data bundle sizes to match various usage patterns.
                    </p>
                </div>
                <div class="animate-slide-up stagger-3" style="animation-fill-mode: forwards;">
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-3">AirtelTigo Data Services</h3>
                    <p class="mb-4">
                        AirtelTigo provides data bundles with various pricing options. Their merged network infrastructure offers coverage across Ghana. Users can choose from different data package sizes based on their individual requirements.
                    </p>
                </div>
                <div class="animate-slide-up stagger-4" style="animation-fill-mode: forwards;">
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-3">Choosing a Data Plan</h3>
                    <p class="mb-4">
                        When selecting a data bundle, consider your usage patterns. Light users may prefer smaller packages (1-3GB) for messaging and browsing. Moderate users (5-10GB) can handle social media and occasional streaming. Heavy users may require larger packages (20GB+) for work or entertainment purposes.
                    </p>
                </div>
            </div>
        </article>
    </section>

    <!-- FAQ Section -->
    <section class="max-w-4xl mx-auto px-6 py-24">
        <h2 class="text-3xl font-black text-center mb-4 animate-slide-up">Frequently Asked Questions</h2>
        <p class="text-center text-muted-theme mb-12 animate-slide-up stagger-1" style="animation-fill-mode: forwards;">Common questions about purchasing data through our platform</p>
        
        <div class="space-y-4">
            <div class="p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-1 opacity-0" style="animation-fill-mode: forwards;">
                <h4 class="font-bold mb-2 text-lg flex items-center gap-2">
                    <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center text-blue-600 text-sm">?</span>
                    How do I add money to my wallet?
                </h4>
                <p class="text-muted-theme text-sm leading-relaxed pl-10">
                    Go to your Wallet page, enter the amount you wish to deposit, and complete the payment via Paystack. Funds are credited instantly to your wallet after payment confirmation.
                </p>
            </div>
            
            <div class="p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-2 opacity-0" style="animation-fill-mode: forwards;">
                <h4 class="font-bold mb-2 text-lg flex items-center gap-2">
                    <span class="w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center text-purple-600 text-sm">?</span>
                    What if my data doesn't arrive?
                </h4>
                <p class="text-muted-theme text-sm leading-relaxed pl-10">
                    If you experience delays beyond 30 minutes, please contact our support team via WhatsApp with your transaction reference number. We aim to resolve all issues promptly.
                </p>
            </div>
            
            <div class="p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-3 opacity-0" style="animation-fill-mode: forwards;">
                <h4 class="font-bold mb-2 text-lg flex items-center gap-2">
                    <span class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center text-green-600 text-sm">?</span>
                    Is my payment information safe?
                </h4>
                <p class="text-muted-theme text-sm leading-relaxed pl-10">
                    We use Paystack, a leading payment processor in Africa, which is PCI-DSS compliant. We do not store your credit card details or Mobile Money PIN. All transactions are encrypted.
                </p>
            </div>
            
            <div class="p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-4 opacity-0" style="animation-fill-mode: forwards;">
                <h4 class="font-bold mb-2 text-lg flex items-center gap-2">
                    <span class="w-8 h-8 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center text-orange-600 text-sm">?</span>
                    Can I buy data for someone else?
                </h4>
                <p class="text-muted-theme text-sm leading-relaxed pl-10">
                    Yes. During checkout, enter the recipient's phone number. The data will be credited to their line. This is useful for gifting data to family members or friends.
                </p>
            </div>
            
            <div class="p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-5 opacity-0" style="animation-fill-mode: forwards;">
                <h4 class="font-bold mb-2 text-lg flex items-center gap-2">
                    <span class="w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center text-red-600 text-sm">?</span>
                    Do the data bundles expire?
                </h4>
                <p class="text-muted-theme text-sm leading-relaxed pl-10">
                    Data bundles typically come with 30 days validity from the date of purchase. Please check the specific validity period for your selected bundle. Unused data will expire after this period.
                </p>
            </div>
        </div>
    </section>

    <!-- Trust Indicators -->
    <section class="max-w-6xl mx-auto px-6 py-16 border-t border-slate-200 dark:border-slate-800">
        <div class="text-center mb-12">
            <h3 class="text-2xl font-bold mb-2">Networks We Support</h3>
            <p class="text-muted-theme">Compatible with major Ghanaian mobile networks</p>
        </div>
        <div class="flex flex-wrap justify-center gap-8 items-center opacity-60">
            <div class="text-xl font-bold text-slate-400">MTN Ghana</div>
            <div class="text-xl font-bold text-slate-400">Telecel</div>
            <div class="text-xl font-bold text-slate-400">AirtelTigo</div>
        </div>
    </section>`;
}

function renderHome(){
  const isExpress = isCurrentlyExpress();
  const BUNDLES = getCurrentBundles();
  
  // Check if user is logged in
  if (!state.user) {
    return `
    <div class="min-h-screen flex items-center justify-center px-4">
      <div class="max-w-md w-full card-theme p-8 rounded-3xl text-center animate-scale-in">
        <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mx-auto mb-6 flex items-center justify-center">
          <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
        </div>
        <h2 class="text-2xl font-black mb-4">Login Required</h2>
        <p class="text-muted-theme mb-8">Please sign in or create an account to purchase data bundles.</p>
        <div class="flex flex-col gap-3">
          <button onclick="navigateTo('login')" class="cta-button text-white py-4 rounded-2xl font-bold text-lg">Sign In</button>
          <button onclick="navigateTo('register')" class="py-4 rounded-2xl font-bold text-slate-600 dark:text-slate-300 border-2 border-slate-200 dark:border-slate-700 hover:border-blue-500 transition-all">Create Account</button>
        </div>
      </div>
    </div>`;
  }
  
  // Get user balance safely
  const userBalance = state.userProfile ? parseFloat(state.userProfile.balance || 0) : 0;
  
  return `
  <div class="animate__animated animate__fadeIn">
    ${state.isDirectMode?'<div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 text-center text-xs font-black uppercase tracking-widest animate-pulse shadow-lg">Direct Order Mode Active</div>':''}
    
    ${isExpress ? `
    <div class="bg-gradient-to-r from-amber-500 to-orange-600 text-white py-3 text-center shadow-lg">
      <div class="flex items-center justify-center gap-2">
        <svg class="w-5 h-5 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
        <span class="font-black uppercase tracking-widest text-sm">‚ö° Express Mode Active - Special Night Prices (9PM - 6AM)</span>
      </div>
    </div>
    ` : ''}
    
    <!-- SEO Hero Section -->
    <section class="relative bg-slate-900 text-white py-24 md:py-32 text-center px-4 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-blue-900/80 via-purple-900/60 to-slate-900/90"></div>
      <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\'100\' height=\'100\' viewBox=\'0 0 100 100\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z\' fill=\'%23ffffff\' fill-opacity=\'0.03\' fill-rule=\'evenodd\'/%3E%3C/svg%3E')] opacity-30"></div>
      
      <div class="relative z-10 max-w-4xl mx-auto">
        <h1 class="text-4xl md:text-6xl font-black mb-6 tracking-tight animate-slide-up leading-tight">
            Buy Data Bundles <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">in Ghana</span>
        </h1>
        <p class="max-w-2xl mx-auto text-slate-300 text-lg md:text-xl mb-8 animate-slide-up stagger-1 leading-relaxed" style="animation-fill-mode: forwards;">
            Convenient access to MTN, Telecel, and AirtelTigo data bundles. Secure Paystack payments. Nationwide service across Ghana.
        </p>
        
        <!-- Wallet Balance Display -->
        <div class="max-w-sm mx-auto mb-8 animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
          <div class="wallet-card">
            <div class="wallet-label">Your Wallet Balance</div>
            <div class="wallet-balance">‚Çµ${userBalance.toFixed(2)}</div>
            
            <!-- FIXED: View Wallet Button - Now properly styled and clickable -->
            <button onclick="navigateTo('wallet')" class="view-wallet-btn mt-6 px-6 py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2 mx-auto min-w-[160px]">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
              View Wallet
            </button>
          </div>
        </div>
        
        <!-- Trust Badges -->
        <div class="flex flex-wrap justify-center gap-4 mb-8 animate-slide-up stagger-3" style="animation-fill-mode: forwards;">
            <span class="px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full text-sm font-semibold flex items-center gap-2">
                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                Secure Checkout
            </span>
            <span class="px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full text-sm font-semibold flex items-center gap-2">
                <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                Paystack Verified
            </span>
            <span class="px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full text-sm font-semibold flex items-center gap-2">
                <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                Competitive Prices
            </span>
        </div>
        
        <div class="animate-slide-up stagger-4" style="animation-fill-mode: forwards;">
            <a href="#networks" class="cta-button text-white px-10 py-5 rounded-2xl font-black shadow-2xl inline-flex items-center gap-3 text-lg group">
                View Data Plans
                <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </a>
        </div>
      </div>
    </section>

    <!-- Ad Container Top -->
    <div class="max-w-5xl mx-auto px-6 my-8">
      <div class="ad-container min-h-[90px]">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2637582768279029"
             data-ad-slot="5392404731"
             data-ad-format="horizontal"
             data-full-width-responsive="true"></ins>
      </div>
    </div>

    <section id="networks" class="max-w-7xl mx-auto px-4 py-16">
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-black mb-4 animate-slide-up">Choose Your Network</h2>
            <p class="text-muted-theme max-w-2xl mx-auto animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
                Select your mobile network below to view available data bundles. We facilitate purchases for all major networks in Ghana.
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
            ${Object.entries(NETWORKS).map(([id,net], index) =>`
            <div onclick="navigateTo('network','${id}')" 
                 class="${net.color} ${net.text} p-8 rounded-[2rem] shadow-2xl network-card text-center border-4 border-white dark:border-slate-800 relative overflow-hidden group animate-scale-in stagger-${index+1}" 
                 style="animation-fill-mode: forwards;">
                <div class="absolute inset-0 bg-gradient-to-br from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <img src="${net.logo}" alt="${net.name}" class="h-16 mx-auto mb-6 bg-white p-3 rounded-2xl shadow-lg relative z-10">
                <h3 class="text-2xl font-black uppercase mb-2 relative z-10">${net.name}</h3>
                <p class="text-xs font-medium mt-2 opacity-80 relative z-10 mb-4">${net.description}</p>
                <span class="inline-flex items-center gap-2 text-xs font-bold bg-black/20 px-4 py-2 rounded-full relative z-10 group-hover:bg-black/30 transition-colors">
                    View Plans
                    <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </span>
            </div>`).join('')}
        </div>
        
        <!-- Inline Ad -->
        <div class="ad-container mb-16 min-h-[250px]">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2637582768279029"
                 data-ad-slot="5392404731"
                 data-ad-format="rectangle"
                 data-full-width-responsive="true"></ins>
        </div>
    </section>

    <!-- More Content for SEO -->
    <section class="bg-slate-50 dark:bg-slate-900/50 py-20">
        <div class="max-w-6xl mx-auto px-6">
            <div class="disclaimer-box mb-8">
              <strong>Affiliate Disclosure:</strong> TRU Data may receive compensation when you purchase data bundles through our platform. This helps us maintain our service and continue offering competitive prices.
            </div>
            
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="animate-slide-up">
                    <h2 class="text-3xl font-black mb-6">Convenient Data Purchases in Ghana</h2>
                    <p class="text-muted-theme mb-6 leading-relaxed">
                        TRU Data Network provides a platform for purchasing mobile data bundles. We work to offer competitive pricing and a streamlined purchasing experience for MTN, Telecel, and AirtelTigo customers.
                    </p>
                    <ul class="space-y-3">
                        <li class="flex items-center gap-3 text-sm font-semibold">
                            <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            Competitive pricing compared to standard rates
                        </li>
                        <li class="flex items-center gap-3 text-sm font-semibold">
                            <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            Simple ordering process - no complex registration
                        </li>
                        <li class="flex items-center gap-3 text-sm font-semibold">
                            <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            Customer support via WhatsApp
                        </li>
                        <li class="flex items-center gap-3 text-sm font-semibold">
                            <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            Compatible with all mobile devices
                        </li>
                    </ul>
                </div>
                <div class="relative animate-scale-in stagger-2" style="animation-fill-mode: forwards;">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-600 rounded-3xl blur-2xl opacity-20"></div>
                    <img src="./11.png" alt="TRU Data App Interface" class="relative rounded-3xl shadow-2xl w-full max-w-md mx-auto">
                </div>
            </div>
        </div>
    </section>
  </div>`;
}

function renderLandingPage(){
  return `
  <div class="min-h-screen animate__animated animate__fadeIn">
    <!-- Hero Section with Center Logo -->
    <section class="relative min-h-[90vh] flex flex-col items-center justify-center px-4 py-20 overflow-hidden bg-gradient-to-br from-slate-50 via-blue-50/50 to-indigo-50 dark:from-slate-950 dark:via-slate-900 dark:to-indigo-950">
      
      <!-- Animated Background Elements -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-72 h-72 bg-blue-400/20 rounded-full blur-3xl animate-float"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-400/20 rounded-full blur-3xl animate-float" style="animation-delay: -3s;"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-indigo-400/10 rounded-full blur-3xl animate-pulse"></div>
      </div>

      <!-- Center Logo -->
      <div class="relative z-10 mb-12 animate-scale-in">
        <div class="relative group">
          <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-600 blur-3xl rounded-full opacity-30 group-hover:opacity-50 transition-opacity duration-500"></div>
          <img src="./11.png" alt="TRU Data Network Logo - Data Bundle Platform" class="hero-logo relative z-10 animate-float">
        </div>
      </div>

      <!-- Welcome Text -->
      <div class="relative z-10 max-w-3xl mx-auto text-center px-4">
        <h1 class="text-4xl md:text-6xl font-black mb-6 tracking-tight animate-slide-up leading-tight">
          Welcome to <span class="gradient-text">TruData</span>
        </h1>
        <p class="text-xl md:text-2xl text-slate-600 dark:text-slate-300 mb-6 font-semibold animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
          Your Platform for Mobile Data Bundle Purchases in Ghana
        </p>
        <p class="text-slate-500 dark:text-slate-400 max-w-2xl mx-auto mb-10 leading-relaxed animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
          TRU DSTA is a digital platform designed to help users purchase mobile data bundles conveniently. We provide an organized interface that allows users to explore and buy data plans across different mobile networks in Ghana.
        </p>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center animate-slide-up stagger-3" style="animation-fill-mode: forwards;">
            <button onclick="navigateTo('login')" class="cta-button text-white px-10 py-5 rounded-2xl font-black text-lg shadow-2xl hover:scale-105 transition-transform flex items-center justify-center gap-2">
                Get Started
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
            </button>
            <button onclick="navigateTo('about')" class="px-10 py-5 rounded-2xl font-bold text-slate-700 dark:text-slate-300 border-2 border-slate-300 dark:border-slate-700 hover:border-blue-500 hover:text-blue-600 dark:hover:text-blue-400 transition-all">
                Learn More
            </button>
        </div>
      </div>
      
      <!-- Scroll Indicator -->
      <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
        <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
      </div>
    </section>

    <!-- Mission Section -->
    <section class="py-20 px-4 bg-white dark:bg-slate-900">
      <div class="max-w-4xl mx-auto text-center">
        <div class="disclaimer-box text-left mb-8">
          <strong>Independent Service Notice:</strong> TruData Network operates as an independent third-party service. We are not owned by or directly affiliated with MTN Ghana, Telecel, or AirtelTigo. All trademarks belong to their respective owners.
        </div>
        
        <p class="text-lg text-slate-600 dark:text-slate-300 leading-relaxed mb-8 animate-slide-up">
          In today's connected world, internet access is essential for education, business, communication, and entertainment. TruData was created to simplify the process of purchasing mobile data by providing a centralized platform where users can compare and buy data plans from multiple networks.
        </p>
        
        <!-- Ad Container -->
        <div class="ad-container my-12 min-h-[100px]">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2637582768279029"
                 data-ad-slot="5392404731"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
      </div>
    </section>

    <!-- What You Can Do Section -->
    <section class="py-20 px-4 bg-slate-50 dark:bg-slate-800/30">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl md:text-4xl font-black text-center mb-4 animate-slide-up">What You Can Do on TruData</h2>
        <p class="text-center text-slate-500 dark:text-slate-400 mb-12 max-w-2xl mx-auto animate-slide-up stagger-1" style="animation-fill-mode: forwards;">TruData provides the following services for mobile data customers:</p>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="feature-card p-8 card-theme rounded-3xl text-center animate-scale-in stagger-1" style="animation-fill-mode: forwards;">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl shadow-lg">üì±</div>
            <h3 class="font-bold text-lg mb-2">Easy Access</h3>
            <p class="text-sm text-muted-theme">Browse mobile data bundle options organized by network for convenient comparison</p>
          </div>
          
          <div class="feature-card p-8 card-theme rounded-3xl text-center animate-scale-in stagger-2" style="animation-fill-mode: forwards;">
            <div class="w-16 h-16 bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900/30 dark:to-purple-800/30 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl shadow-lg">üí∞</div>
            <h3 class="font-bold text-lg mb-2">Clear Pricing</h3>
            <p class="text-sm text-muted-theme">Data sizes, pricing, and validity periods displayed transparently</p>
          </div>
          
          <div class="feature-card p-8 card-theme rounded-3xl text-center animate-scale-in stagger-3" style="animation-fill-mode: forwards;">
            <div class="w-16 h-16 bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/30 dark:to-green-800/30 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl shadow-lg">üåê</div>
            <h3 class="font-bold text-lg mb-2">Network Based</h3>
            <p class="text-sm text-muted-theme">Organized by network provider for faster navigation</p>
          </div>
          
          <div class="feature-card p-8 card-theme rounded-3xl text-center animate-scale-in stagger-4" style="animation-fill-mode: forwards;">
            <div class="w-16 h-16 bg-gradient-to-br from-orange-100 to-orange-200 dark:from-orange-900/30 dark:to-orange-800/30 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl shadow-lg">‚ö°</div>
            <h3 class="font-bold text-lg mb-2">Simple Interface</h3>
            <p class="text-sm text-muted-theme">Designed for all devices with intuitive navigation</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Who Is It For Section -->
    <section class="py-20 px-4 bg-white dark:bg-slate-900">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl md:text-4xl font-black text-center mb-4 animate-slide-up">Who TruData Is For</h2>
        <p class="text-center text-slate-600 dark:text-slate-300 mb-12 max-w-2xl mx-auto animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
          TruData serves a wide range of users who need convenient access to mobile data purchasing options.
        </p>
        
        <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
          <div class="flex items-start gap-4 p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-1 opacity-0" style="animation-fill-mode: forwards;">
            <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl flex items-center justify-center font-bold text-2xl shrink-0 shadow-lg shadow-blue-500/30">üéì</div>
            <div>
              <h4 class="font-bold text-lg mb-1">Students</h4>
              <p class="text-sm text-muted-theme">Who need mobile data for online learning, research, and educational resources</p>
            </div>
          </div>
          
          <div class="flex items-start gap-4 p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-2 opacity-0" style="animation-fill-mode: forwards;">
            <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl flex items-center justify-center font-bold text-2xl shrink-0 shadow-lg shadow-purple-500/30">üíº</div>
            <div>
              <h4 class="font-bold text-lg mb-1">Professionals</h4>
              <p class="text-sm text-muted-theme">And remote workers who need reliable connectivity for work activities</p>
            </div>
          </div>
          
          <div class="flex items-start gap-4 p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-3 opacity-0" style="animation-fill-mode: forwards;">
            <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl flex items-center justify-center font-bold text-2xl shrink-0 shadow-lg shadow-green-500/30">üè™</div>
            <div>
              <h4 class="font-bold text-lg mb-1">Business Owners</h4>
              <p class="text-sm text-muted-theme">Managing online business activities and digital operations</p>
            </div>
          </div>
          
          <div class="flex items-start gap-4 p-6 card-theme rounded-2xl feature-card animate-slide-up stagger-4 opacity-0" style="animation-fill-mode: forwards;">
            <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-xl flex items-center justify-center font-bold text-2xl shrink-0 shadow-lg shadow-orange-500/30">üë•</div>
            <div>
              <h4 class="font-bold text-lg mb-1">Everyday Users</h4>
              <p class="text-sm text-muted-theme">Who want convenient options for managing data purchases</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Why It Matters Section -->
    <section class="py-20 px-4 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white relative overflow-hidden">
      <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'0.03\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')]"></div>
      
      <div class="max-w-4xl mx-auto text-center relative z-10">
        <h2 class="text-3xl md:text-4xl font-black mb-8 animate-slide-up">Why TruData Matters</h2>
        <p class="text-lg text-slate-300 mb-8 leading-relaxed animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
          Many users experience challenges such as unclear pricing, confusing bundle options, or limited explanations when selecting mobile data plans. TruData addresses these challenges by focusing on transparency and accessibility.
        </p>
        <p class="text-lg text-slate-300 leading-relaxed animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
          By organizing information clearly and presenting it in a straightforward format, TruData helps users make informed digital decisions and find suitable data options for their needs.
        </p>
        
        <!-- Ad Container Dark -->
        <div class="mt-12 ad-container bg-white/5 border-white/10">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2637582768279029"
                 data-ad-slot="5392404731"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
      </div>
    </section>

    <!-- Getting Started CTA -->
    <section class="py-20 px-4 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 animate-gradient relative overflow-hidden">
      <div class="absolute inset-0 bg-black/10"></div>
      <div class="max-w-4xl mx-auto text-center relative z-10">
        <h2 class="text-3xl md:text-4xl font-black mb-6 text-white animate-slide-up">Ready to Get Started?</h2>
        <p class="text-xl text-blue-100 mb-10 max-w-2xl mx-auto animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
          Create your free account today and start purchasing data bundles with ease.
        </p>
        <button onclick="navigateTo('register')" class="bg-white text-blue-600 px-12 py-5 rounded-2xl font-black text-lg shadow-2xl hover:scale-105 hover:shadow-white/25 transition-all animate-slide-up stagger-2 flex items-center gap-3 mx-auto" style="animation-fill-mode: forwards;">
          Create Free Account
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
        </button>
      </div>
    </section>
  </div>`;
}

function renderAbout(){
    return `
    <div class="animate__animated animate__fadeIn">
        <section class="py-20 px-4 max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-5xl font-black mb-8 text-center animate-slide-up">About TRU Data Network</h1>
            
            <div class="disclaimer-box mb-8">
              <strong>Company Information:</strong> TRU Data Network is an independent business operating in Ghana. We facilitate the purchase of mobile data bundles through partnerships with authorized vendors. We are not a telecommunications company.
            </div>
            
            <div class="prose prose-slate dark:prose-invert max-w-none">
                <p class="text-lg text-muted-theme mb-8 animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
                    TRU Data Network was established to provide Ghanaians with a convenient way to purchase mobile data bundles online. We recognized that many people were looking for easier ways to buy data without visiting physical stores or navigating complex USSD codes.
                </p>
                
                <div class="grid md:grid-cols-2 gap-8 mb-12">
                    <div class="p-6 card-theme rounded-2xl animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
                        <h3 class="text-xl font-bold mb-3 text-blue-600">Our Vision</h3>
                        <p class="text-sm text-muted-theme">To become a trusted platform for mobile data purchases in Ghana, providing convenient access to connectivity for all users.</p>
                    </div>
                    <div class="p-6 card-theme rounded-2xl animate-slide-up stagger-3" style="animation-fill-mode: forwards;">
                        <h3 class="text-xl font-bold mb-3 text-purple-600">Our Mission</h3>
                        <p class="text-sm text-muted-theme">To simplify the data purchasing process while maintaining transparency and customer satisfaction.</p>
                    </div>
                </div>
                
                <h2 class="text-2xl font-bold mb-4 animate-slide-up stagger-4" style="animation-fill-mode: forwards;">Why We Exist</h2>
                <p class="text-muted-theme mb-6 animate-slide-up stagger-4" style="animation-fill-mode: forwards;">
                    In today's digital age, internet connectivity is increasingly important for education, work, and communication. However, the process of purchasing data in Ghana can sometimes be inconvenient. TRU Data Network addresses this by providing an online platform where users can browse, compare, and purchase data bundles from major networks.
                </p>
                <p class="text-muted-theme mb-6 animate-slide-up stagger-5" style="animation-fill-mode: forwards;">
                    We work with authorized partners to facilitate these purchases. While we strive to offer competitive prices, all data is provided through official network channels.
                </p>
                
                <div class="ad-container my-12 min-h-[250px]">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-2637582768279029"
                         data-ad-slot="5392404731"
                         data-ad-format="rectangle"
                         data-full-width-responsive="true"></ins>
                </div>
                
                <h2 class="text-2xl font-bold mb-4">Our Values</h2>
                <ul class="space-y-4 mb-12">
                    <li class="flex items-start gap-3">
                        <svg class="w-6 h-6 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        <div>
                            <strong class="block text-slate-900 dark:text-white">Transparency</strong>
                            <span class="text-sm text-muted-theme">Clear pricing with no hidden fees. What you see is what you pay.</span>
                        </div>
                    </li>
                    <li class="flex items-start gap-3">
                        <svg class="w-6 h-6 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        <div>
                            <strong class="block text-slate-900 dark:text-white">Reliability</strong>
                            <span class="text-sm text-muted-theme">We work to ensure timely processing of all orders.</span>
                        </div>
                    </li>
                    <li class="flex items-start gap-3">
                        <svg class="w-6 h-6 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        <div>
                            <strong class="block text-slate-900 dark:text-white">Customer Support</strong>
                            <span class="text-sm text-muted-theme">Assistance available via WhatsApp for order inquiries.</span>
                        </div>
                    </li>
                </ul>
            </div>
        </section>
    </div>`;
}

function renderLogin() {
  return `
  <div class="min-h-screen flex items-center justify-center px-4 py-20">
    <div class="max-w-md w-full card-theme p-8 md:p-10 rounded-[2.5rem] shadow-2xl animate-scale-in">
      <div class="text-center mb-8">
        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center text-white text-2xl font-black">TRU</div>
        <h2 class="text-2xl font-black">Welcome Back</h2>
        <p class="text-sm text-muted-theme mt-2">Sign in to your account to continue</p>
      </div>
      
      <form onsubmit="handleLogin(event)" class="space-y-4">
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Email Address</label>
          <input type="email" id="login-email" required class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="you@example.com">
        </div>
        
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Password</label>
          <input type="password" id="login-password" required class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        
        <button type="submit" class="w-full cta-button text-white py-4 rounded-2xl font-black text-lg shadow-lg hover:shadow-xl transition-all mt-6">
          Sign In
        </button>
      </form>
      
      <div class="mt-6 flex justify-between items-center">
        <button onclick="navigateTo('register')" class="text-sm text-blue-600 font-bold hover:underline">Create account</button>
        <button onclick="navigateTo('forgot-password')" class="text-sm text-muted-theme hover:text-blue-600 transition-colors">Forgot password?</button>
      </div>
    </div>
  </div>`;
}

function renderRegister() {
  return `
  <div class="min-h-screen flex items-center justify-center px-4 py-20">
    <div class="max-w-md w-full card-theme p-8 md:p-10 rounded-[2.5rem] shadow-2xl animate-scale-in">
      <div class="text-center mb-8">
        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center text-white text-2xl font-black">TRU</div>
        <h2 class="text-2xl font-black">Create Account</h2>
        <p class="text-sm text-muted-theme mt-2">Join TRU Data to start purchasing bundles</p>
      </div>
      
      <form onsubmit="handleRegister(event)" class="space-y-4">
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Full Name</label>
          <input type="text" id="reg-name" required class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="John Doe">
        </div>
        
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Email Address</label>
          <input type="email" id="reg-email" required class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="you@example.com">
        </div>
        
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Phone Number</label>
          <input type="tel" id="reg-phone" required maxlength="10" class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="024xxxxxxx">
        </div>
        
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Password</label>
          <input type="password" id="reg-password" required minlength="6" class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        
        <button type="submit" class="w-full cta-button text-white py-4 rounded-2xl font-black text-lg shadow-lg hover:shadow-xl transition-all mt-6">
          Create Account
        </button>
      </form>
      
      <div class="mt-6 text-center">
        <p class="text-sm text-muted-theme">
          Already have an account? 
          <button onclick="navigateTo('login')" class="text-blue-600 font-bold hover:underline">Sign in</button>
        </p>
      </div>
    </div>
  </div>`;
}

function renderForgotPassword() {
  return `
  <div class="min-h-screen flex items-center justify-center px-4 py-20">
    <div class="max-w-md w-full card-theme p-8 md:p-10 rounded-[2.5rem] shadow-2xl animate-scale-in">
      <div class="text-center mb-8">
        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center text-white text-2xl font-black">TRU</div>
        <h2 class="text-2xl font-black">Reset Password</h2>
        <p class="text-sm text-muted-theme mt-2">Enter your email to receive reset instructions</p>
      </div>
      
      <form onsubmit="handleForgotPassword(event)" class="space-y-4">
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Email Address</label>
          <input type="email" id="forgot-email" required class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="you@example.com">
        </div>
        
        <button type="submit" class="w-full cta-button text-white py-4 rounded-2xl font-black text-lg shadow-lg hover:shadow-xl transition-all mt-6">
          Send Reset Link
        </button>
      </form>
      
      <div class="mt-6 text-center">
        <p class="text-sm text-muted-theme">
          Remember your password? 
          <button onclick="navigateTo('login')" class="text-blue-600 font-bold hover:underline">Sign in</button>
        </p>
      </div>
    </div>
  </div>`;
}

function renderWallet() {
  const balance = state.userProfile ? parseFloat(state.userProfile.balance || 0) : 0;
  const depositFeePercent = 2.00;
  
  return `
  <div class="max-w-4xl mx-auto px-4 py-16 animate__animated animate__fadeIn">
    <div class="mb-8">
      <button onclick="navigateTo('home')" class="font-bold text-blue-600 hover:text-blue-700 dark:hover:text-blue-400 transition-colors flex items-center gap-2 group">
        <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        Back to Home
      </button>
    </div>
    
    <div class="grid md:grid-cols-2 gap-8">
      <!-- Balance Card -->
      <div class="wallet-card animate-scale-in">
        <div class="wallet-label">Current Balance</div>
        <div class="wallet-balance">‚Çµ${balance.toFixed(2)}</div>
        <div class="mt-4 flex items-center gap-2 text-sm opacity-90">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
          Available for purchases
        </div>
        ${!state.userProfile ? '<div class="mt-4 text-xs bg-red-500/20 px-3 py-2 rounded-lg">‚ö†Ô∏è Profile not loaded properly. Please refresh.</div>' : ''}
      </div>
      
      <!-- Deposit Form -->
      <div class="card-theme p-8 rounded-3xl animate-scale-in stagger-1" style="animation-fill-mode: forwards;">
        <h3 class="text-xl font-black mb-6">Add Funds</h3>
        
        <div class="space-y-4">
          <div>
            <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Amount to Deposit (‚Çµ)</label>
            <input type="number" id="deposit-amount" min="5" step="0.01" 
                   oninput="updateDepositCalculation(this.value)"
                   class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl text-2xl font-black focus:border-blue-600 outline-none transition-all" 
                   placeholder="0.00">
          </div>
          
          <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl space-y-2">
            <div class="flex justify-between text-sm">
              <span class="text-muted-theme">Deposit Amount:</span>
              <span class="font-bold" id="calc-amount">‚Çµ0.00</span>
            </div>
            <div class="border-t border-slate-200 dark:border-slate-700 pt-2 flex justify-between">
              <span class="font-bold">Total to Pay:</span>
              <span class="font-black text-lg text-blue-600" id="calc-total">‚Çµ0.00</span>
            </div>
          </div>
          
          <button onclick="initiateDeposit()" id="deposit-btn" disabled
                  class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-2xl font-black text-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            Deposit Now
          </button>
          
          ${!state.userProfile ? '<p class="text-xs text-red-500 mt-2">‚ö†Ô∏è Cannot process deposits until profile is loaded.</p>' : ''}
        </div>
      </div>
    </div>
    
    <!-- Transaction History -->
    <div class="mt-12 card-theme p-8 rounded-3xl animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
      <h3 class="text-xl font-black mb-6">Recent Transactions</h3>
      <div class="space-y-4" id="transaction-list">
        <p class="text-center text-muted-theme py-8">Loading transactions...</p>
      </div>
    </div>
  </div>`;
}

function updateDepositCalculation(amount) {
  const numAmount = parseFloat(amount) || 0;
  const feePercent = 2.00;
  const fee = numAmount * (feePercent / 100);
  const total = numAmount + fee;
  
  // Safely update elements if they exist
  const amountEl = document.getElementById('calc-amount');
  const totalEl = document.getElementById('calc-total');
  const btn = document.getElementById('deposit-btn');
  
  if (amountEl) amountEl.textContent = `‚Çµ${numAmount.toFixed(2)}`;
  if (totalEl) totalEl.textContent = `‚Çµ${total.toFixed(2)}`;
  if (btn) btn.disabled = numAmount < 5 || !state.userProfile;
}

/* ================== AUTH & DATA FUNCTIONS ================== */
async function handleRegister(e) {
  e.preventDefault();
  const name = document.getElementById('reg-name').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  const phone = document.getElementById('reg-phone').value.trim();
  const password = document.getElementById('reg-password').value;
  
  // Validate phone
  const phoneValidation = validateGhanaPhone(phone);
  if (!phoneValidation.isValid) {
    showToast('‚ùå ' + phoneValidation.error, 4000, 'error');
    return;
  }
  
  state.isLoading = true;
  
  try {
    // Step 1: Create auth user
    const { data: authData, error: authError } = await supa.auth.signUp({
      email,
      password,
      options: {
        data: {
          full_name: name,
          phone: phone
        }
      }
    });
    
    if (authError) throw authError;
    
    if (!authData.user) {
      throw new Error('Failed to create user account');
    }
    
    // Step 2: Create profile immediately with user ID
    // Use insert instead of upsert to avoid conflicts, with error handling
    const profileData = {
      id: authData.user.id,
      full_name: name,
      phone: phone,
      email: email,
      balance: 0,
      created_at: new Date().toISOString()
    };
    
    const { error: profileError } = await supa
      .from('profiles')
      .insert([profileData]);
    
    if (profileError) {
      console.error('Profile creation error:', profileError);
      // If profile creation fails due to duplicate, try to update instead
      if (profileError.code === '23505') { // Unique violation
        const { error: updateError } = await supa
          .from('profiles')
          .update({
            full_name: name,
            phone: phone,
            email: email
          })
          .eq('id', authData.user.id);
          
        if (updateError) {
          console.error('Profile update error:', updateError);
        }
      } else {
        showToast('‚ö†Ô∏è Account created but profile setup incomplete. Please contact support.', 5000, 'error');
      }
    }
    
    // Step 3: Check if email confirmation is required
    if (authData.session) {
      // Email confirmation not required or already confirmed, auto-login
      state.user = authData.user;
      await fetchUserProfile();
      showToast('‚úÖ Account created successfully! Welcome to TRU Data.', 4000, 'success');
      navigateTo('home');
    } else {
      // Email confirmation required
      showToast('‚úÖ Account created! Please check your email to confirm your account before logging in.', 5000, 'success');
      navigateTo('login');
    }
    
  } catch (err) {
    console.error('Registration error:', err);
    showToast('‚ùå ' + (err.message || 'Registration failed. Please try again.'), 4000, 'error');
  } finally {
    state.isLoading = false;
  }
}

async function handleLogin(e) {
  e.preventDefault();
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  
  try {
    const { data, error } = await supa.auth.signInWithPassword({
      email,
      password
    });
    
    if (error) throw error;
    
    state.user = data.user;
    await fetchUserProfile();
    showToast('‚úÖ Welcome back!', 3000, 'success');
    navigateTo('home');
  } catch (err) {
    console.error('Login error:', err);
    showToast('‚ùå ' + (err.message || 'Login failed. Please check your credentials.'), 4000, 'error');
  }
}

async function logoutUser() {
  try {
    await supa.auth.signOut();
    state.user = null;
    state.userProfile = null;
    state.isAdmin = false;
    showToast('‚úÖ Logged out successfully', 3000, 'success');
    navigateTo('landing');
  } catch (err) {
    showToast('‚ùå Logout failed. Please try again.', 3000, 'error');
  }
}

async function fetchUserProfile() {
  if (!state.user) {
    console.log('No user logged in, skipping profile fetch');
    return;
  }
  
  try {
    // Try to fetch existing profile
    let { data, error } = await supa
      .from('profiles')
      .select('*')
      .eq('id', state.user.id)
      .single();
    
    if (error) {
      console.log('Profile fetch error:', error);
      
      // If profile doesn't exist (PGRST116 = no rows), create it
      if (error.code === 'PGRST116') {
        console.log('Profile not found, creating new profile...');
        const newProfile = {
          id: state.user.id,
          full_name: state.user.user_metadata?.full_name || 'User',
          phone: state.user.user_metadata?.phone || '',
          email: state.user.email,
          balance: 0,
          created_at: new Date().toISOString()
        };
        
        const { data: createdProfile, error: createError } = await supa
          .from('profiles')
          .insert([newProfile])
          .select()
          .single();
          
        if (createError) {
          console.error('Failed to create profile:', createError);
          throw createError;
        }
        
        data = createdProfile;
        showToast('‚úÖ Profile created successfully', 3000, 'success');
      } else {
        throw error;
      }
    }
    
    if (data) {
      state.userProfile = data;
      // Fetch transactions after profile is loaded
      await fetchUserTransactions();
    } else {
      throw new Error('Failed to load or create profile');
    }
    
  } catch (err) {
    console.error('Error in fetchUserProfile:', err);
    state.userProfile = null;
    showToast('‚ö†Ô∏è Error loading profile data. Some features may be limited.', 4000, 'error');
  }
}

async function fetchUserTransactions() {
  if (!state.user) return;
  
  const listEl = document.getElementById('transaction-list');
  if (!listEl) return;
  
  try {
    listEl.innerHTML = '<div class="flex justify-center py-8"><div class="spinner"></div></div>';
    
    const { data, error } = await supa
      .from('transactions')
      .select('*')
      .eq('user_id', state.user.id)
      .order('created_at', { ascending: false })
      .limit(10);
    
    if (error) {
      throw error;
    }
    
    if (data && data.length > 0) {
      listEl.innerHTML = data.map(t => `
        <div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-colors">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full flex items-center justify-center ${t.type === 'deposit' ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                ${t.type === 'deposit' 
                  ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>'
                  : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'
                }
              </svg>
            </div>
            <div>
              <p class="font-bold text-sm">${t.type === 'deposit' ? 'Wallet Deposit' : 'Data Purchase'}</p>
              <p class="text-xs text-muted-theme">${new Date(t.created_at).toLocaleDateString()} ‚Ä¢ ${new Date(t.created_at).toLocaleTimeString()}</p>
            </div>
          </div>
          <div class="text-right">
            <p class="font-bold ${t.type === 'deposit' ? 'text-green-600' : 'text-slate-900 dark:text-white'}">
              ${t.type === 'deposit' ? '+' : '-'}‚Çµ${parseFloat(t.amount).toFixed(2)}
            </p>
            <p class="text-xs ${t.status === 'completed' ? 'text-green-600' : 'text-yellow-600'}">${t.status}</p>
          </div>
        </div>
      `).join('');
    } else {
      listEl.innerHTML = '<div class="text-center py-8 text-muted-theme"><svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>No transactions yet</div>';
    }
  } catch (err) {
    console.error('Error fetching transactions:', err);
    if (listEl) {
      listEl.innerHTML = '<div class="text-center py-8 text-red-500">Failed to load transactions. Please refresh the page.</div>';
    }
  }
}

/* ================== FORGOT PASSWORD ================== */
async function handleForgotPassword(e) {
  e.preventDefault();
  const email = document.getElementById('forgot-email').value.trim();
  
  try {
    const { error } = await supa.auth.resetPasswordForEmail(email, {
      redirectTo: window.location.origin + '/index.html',
    });
    
    if (error) throw error;
    
    showToast('‚úÖ Check your email for password reset instructions!', 4000, 'success');
    navigateTo('login');
  } catch (err) {
    console.error('Password reset error:', err);
    showToast('‚ùå ' + (err.message || 'Failed to send reset email'), 4000, 'error');
  }
}

/* ================== DEPOSIT FUNCTIONS ================== */
function initiateDeposit() {
  if (!state.userProfile) {
    showToast('‚ùå Profile not loaded. Please refresh the page.', 4000, 'error');
    return;
  }
  
  const amountInput = document.getElementById('deposit-amount');
  const amount = parseFloat(amountInput.value);
  
  if (!amount || amount < 5) {
    showToast('‚ùå Minimum deposit amount is ‚Çµ5.00', 3000, 'error');
    return;
  }
  
  const feePercent = 2.00;
  const fee = amount * (feePercent / 100);
  const totalAmount = amount + fee;
  
  try {
    const handler = PaystackPop.setup({
      key: PAYSTACK_KEY,
      email: state.user.email,
      amount: Math.round(totalAmount * 100),
      currency: 'GHS',
      metadata: {
        custom_fields: [
          { display_name: "Deposit Type", variable_name: "deposit_type", value: "wallet_funding" },
          { display_name: "Net Amount", variable_name: "net_amount", value: amount.toFixed(2) },
          { display_name: "Fee", variable_name: "fee", value: fee.toFixed(2) }
        ]
      },
      callback: (response) => processDeposit(response, amount, fee),
      onClose: () => showToast('Payment window closed', 3000, 'info')
    });
    
    handler.openIframe();
  } catch (err) {
    console.error('Paystack error:', err);
    showToast('‚ùå Payment initialization failed. Please try again.', 4000, 'error');
  }
}

async function processDeposit(response, netAmount, fee) {
  if (!state.user || !state.userProfile) {
    showToast('‚ùå Session error. Please login again.', 4000, 'error');
    return;
  }
  
  try {
    // Record transaction first
    const { error: transError } = await supa
      .from('transactions')
      .insert([{
        user_id: state.user.id,
        type: 'deposit',
        amount: netAmount,
        fee: fee,
        reference: response.reference,
        status: 'completed',
        created_at: new Date().toISOString()
      }]);
    
    if (transError) {
      console.error('Transaction record error:', transError);
      throw new Error('Failed to record transaction');
    }
    
    // Calculate and update new balance
    const currentBalance = parseFloat(state.userProfile.balance || 0);
    const newBalance = currentBalance + netAmount;
    
    const { error: updateError } = await supa
      .from('profiles')
      .update({ balance: newBalance })
      .eq('id', state.user.id);
    
    if (updateError) {
      console.error('Balance update error:', updateError);
      throw new Error('Failed to update balance');
    }
    
    // Update local state
    state.userProfile.balance = newBalance;
    
    // Clear deposit input
    const amountInput = document.getElementById('deposit-amount');
    if (amountInput) amountInput.value = '';
    updateDepositCalculation(0);
    
    showToast(`‚úÖ Deposit successful! ‚Çµ${netAmount.toFixed(2)} added to your wallet`, 4000, 'success');
    
    // Refresh transactions display
    await fetchUserTransactions();
    
  } catch (err) {
    console.error('Deposit processing error:', err);
    showToast('‚ùå Error processing deposit: ' + (err.message || 'Unknown error'), 5000, 'error');
  }
}

/* ================== NETWORK VIEW ================== */
function renderNetworkView(networkId) {
  const network = NETWORKS[networkId];
  const BUNDLES = getCurrentBundles().filter(b => b.network === networkId);
  const isExpress = isCurrentlyExpress();
  
  return `
  <div class="animate__animated animate__fadeIn max-w-6xl mx-auto px-4 py-8">
    <div class="mb-8">
      <button onclick="navigateTo('home')" class="font-bold text-blue-600 hover:text-blue-700 dark:hover:text-blue-400 transition-colors flex items-center gap-2 group">
        <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        Back to Networks
      </button>
    </div>
    
    <div class="${network.color} ${network.text} rounded-3xl p-8 md:p-12 mb-12 text-center relative overflow-hidden animate-scale-in">
      <div class="absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"></div>
      <img src="${network.logo}" alt="${network.name}" class="h-20 mx-auto mb-6 bg-white p-4 rounded-2xl shadow-xl relative z-10">
      <h1 class="text-3xl md:text-4xl font-black uppercase relative z-10 mb-2">${network.name}</h1>
      <p class="text-sm md:text-base opacity-90 relative z-10 max-w-2xl mx-auto">${network.description}</p>
      ${isExpress ? '<div class="mt-4 inline-block bg-black/20 px-4 py-1 rounded-full text-xs font-bold animate-pulse">‚ö° Express Mode Active</div>' : ''}
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      ${BUNDLES.map((bundle, idx) => `
        <div class="card-theme p-6 rounded-2xl hover:border-blue-500 transition-all cursor-pointer group animate-slide-up stagger-${(idx % 5) + 1}" style="animation-fill-mode: forwards;" onclick="initiateOrder('${networkId}', '${bundle.id}')">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h3 class="text-2xl font-black text-slate-900 dark:text-white group-hover:text-blue-600 transition-colors">${bundle.size}</h3>
              <p class="text-sm text-muted-theme">${bundle.validity} Validity</p>
            </div>
            <div class="price-tag">‚Çµ${bundle.price.toFixed(2)}</div>
          </div>
          
          <div class="flex items-center justify-between mt-6 pt-4 border-t border-slate-200 dark:border-slate-700">
            <span class="text-xs font-bold text-slate-500 uppercase">Click to Purchase</span>
            <svg class="w-5 h-5 text-blue-600 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
          </div>
        </div>
      `).join('')}
    </div>
  </div>`;
}

function initiateOrder(networkId, bundleId) {
  const BUNDLES = getCurrentBundles();
  const bundle = BUNDLES.find(b => b.network === networkId && b.id === bundleId);
  
  if (!bundle) {
    showToast('‚ùå Bundle not found', 3000, 'error');
    return;
  }
  
  if (!state.user) {
    showToast('‚ùå Please login first', 3000, 'error');
    navigateTo('login');
    return;
  }
  
  // Check if profile is loaded
  if (!state.userProfile) {
    showToast('‚ö†Ô∏è Profile loading... Please wait a moment and try again.', 3000, 'error');
    fetchUserProfile(); // Try to reload profile
    return;
  }
  
  state.activeOrderData = { network: networkId, bundle: bundle };
  render();
}

function renderOrderForm() {
  if (!state.activeOrderData) return '';
  
  const { network, bundle } = state.activeOrderData;
  const netInfo = NETWORKS[network];
  const balance = state.userProfile ? parseFloat(state.userProfile.balance || 0) : 0;
  const hasSufficientBalance = balance >= bundle.price;
  
  return `
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate__animated animate__fadeIn">
    <div class="card-theme max-w-md w-full rounded-3xl p-8 relative animate-scale-in">
      <button onclick="state.activeOrderData=null; render();" class="absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
      </button>
      
      <div class="text-center mb-6">
        <div class="${netInfo.color} ${netInfo.text} w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
          <span class="text-2xl font-black">${netInfo.name.charAt(0)}</span>
        </div>
        <h3 class="text-2xl font-black mb-1">Purchase ${bundle.size}</h3>
        <p class="text-muted-theme text-sm">${netInfo.name} ‚Ä¢ ${bundle.validity}</p>
      </div>
      
      <div class="bg-slate-50 dark:bg-slate-800/50 rounded-2xl p-6 mb-6">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm text-muted-theme">Bundle Price</span>
          <span class="font-bold text-lg">‚Çµ${bundle.price.toFixed(2)}</span>
        </div>
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm text-muted-theme">Your Balance</span>
          <span class="font-bold text-lg ${hasSufficientBalance ? 'text-green-600' : 'text-red-500'}">‚Çµ${balance.toFixed(2)}</span>
        </div>
        <div class="border-t border-slate-200 dark:border-slate-700 mt-2 pt-2 flex justify-between items-center">
          <span class="font-bold">Total</span>
          <span class="font-black text-xl text-blue-600">‚Çµ${bundle.price.toFixed(2)}</span>
        </div>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Phone Number</label>
          <input type="tel" id="p-num" maxlength="10" class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="024xxxxxxx">
          <p class="text-xs text-muted-theme mt-2">Enter 10-digit Ghana number</p>
        </div>
        
        <button onclick="handleOrderButton()" class="w-full cta-button text-white py-4 rounded-2xl font-black text-lg shadow-lg hover:shadow-xl transition-all ${hasSufficientBalance ? '' : 'opacity-50 cursor-not-allowed'}" ${hasSufficientBalance ? '' : 'disabled'}>
          ${hasSufficientBalance ? 'Confirm Purchase' : 'Insufficient Balance'}
        </button>
        
        ${!hasSufficientBalance ? `
        <button onclick="state.activeOrderData=null; navigateTo('wallet')" class="w-full bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 py-3 rounded-2xl font-bold hover:bg-slate-300 dark:hover:bg-slate-600 transition-all">
          Add Funds to Wallet
        </button>
        ` : ''}
      </div>
    </div>
  </div>`;
}

/* ================== ORDER FUNCTIONS ================== */
async function handleOrderButton(){
  const phoneInput = document.getElementById('p-num');
  const phone = phoneInput.value.trim();
  
  // Validate Ghana phone number
  const validation = validateGhanaPhone(phone);
  if (!validation.isValid) {
    showToast('‚ùå ' + validation.error, 4000, 'error');
    phoneInput.focus();
    return;
  }
  
  const {bundle} = state.activeOrderData;
  
  // Check wallet balance
  const balance = parseFloat(state.userProfile?.balance || 0);
  if (balance < bundle.price) {
    showToast('‚ùå Insufficient balance. Please deposit funds.', 4000, 'error');
    navigateTo('wallet');
    return;
  }
  
  if(state.isAdmin && state.isDirectMode){
    // Direct order with provider selection - save with Processing status and redirect
    const provider = state.selectedProvider || 'evnetwork';
    const providerUrl = provider === 'evnetwork' ? 'https://evnetwork.shop' : 'https://refer2bundle.com';
    const ref = 'DIR-' + Math.random().toString(36).slice(2, 10).toUpperCase();
    
    try {
      // Deduct from balance
      const newBalance = balance - bundle.price;
      const { error: balanceError } = await supa
        .from('profiles')
        .update({ balance: newBalance })
        .eq('id', state.user.id);
      
      if (balanceError) throw balanceError;
      
      // Record transaction
      await supa.from('transactions').insert([{
        user_id: state.user.id,
        type: 'purchase',
        amount: bundle.price,
        reference: ref,
        status: 'completed',
        created_at: new Date().toISOString()
      }]);
      
      // Save order
      const {error} = await supa.from('orders').insert([{
        ref: ref,
        Phone: phone,
        Network: bundle.network,
        bundle_name: bundle.size,
        Amount: bundle.price,
        Status: 'Processing',
        provider: provider,
        user_id: state.user.id,
        created_at: new Date().toISOString()
      }]);
      
      if(error) throw error;
      
      // Update local balance
      state.userProfile.balance = newBalance;
      
      showToast('‚úÖ Direct order created and saved', 3000, 'success');
      window.open(providerUrl, '_blank');
      
      state.isDirectMode = false;
      state.selectedProvider = 'evnetwork';
      navigateTo('admin-dashboard');
    } catch(err) {
      console.error('Order error:', err);
      showToast('‚ùå Error creating order: ' + (err.message || 'Unknown error'), 4000, 'error');
    }
  } else {
    // Regular user order - deduct from wallet
    try {
      // Deduct from balance
      const newBalance = balance - bundle.price;
      const { error: balanceError } = await supa
        .from('profiles')
        .update({ balance: newBalance })
        .eq('id', state.user.id);
      
      if (balanceError) throw balanceError;
      
      const ref = 'ORD-' + Math.random().toString(36).slice(2, 10).toUpperCase();
      
      // Record transaction
      await supa.from('transactions').insert([{
        user_id: state.user.id,
        type: 'purchase',
        amount: bundle.price,
        reference: ref,
        status: 'completed',
        created_at: new Date().toISOString()
      }]);
      
      // Save order
      await supa.from('orders').insert([{
        ref: ref,
        Phone: phone,
        Network: bundle.network,
        bundle_name: bundle.size,
        Amount: bundle.price,
        Status: 'Pending',
        user_id: state.user.id,
        created_at: new Date().toISOString()
      }]);
      
      // Update local balance
      state.userProfile.balance = newBalance;
      
      showToast('‚úÖ Order placed successfully!', 3000, 'success');
      navigateTo('success', {
        bundle_name: bundle.size, 
        Phone: phone,
        ref: ref
      });
    } catch (err) {
      console.error('Order error:', err);
      showToast('‚ùå Error placing order: ' + (err.message || 'Unknown error'), 4000, 'error');
    }
  }
}

/* ================== ADMIN FUNCTIONS ================== */
window.adminAuth=async(e)=>{
    e.preventDefault();
    const email = document.getElementById('adm-u').value.trim();
    const password = document.getElementById('adm-p').value;
    
    const btn = e.target.querySelector('button');
    const originalText = btn.innerText;
    btn.innerHTML = '<span class="spinner inline-block mr-2"></span>Signing in...';
    btn.disabled = true;
    
    try {
        const {data, error} = await supa.auth.signInWithPassword({email, password});
        if(error) throw error;
        state.isAdmin = true;
        showToast('‚úÖ Login successful', 3000, 'success');
        navigateTo('admin-dashboard');
    } catch(err) {
        showToast('‚ùå ' + (err.message || 'Login failed'), 4000, 'error');
        btn.innerText = originalText;
        btn.disabled = false;
    }
};

async function adminLogout() {
    try {
        await supa.auth.signOut();
        state.isAdmin = false;
        state.isDirectMode = false;
        showToast('‚úÖ Logged out successfully', 3000, 'success');
        navigateTo('landing');
    } catch(err) {
        showToast('‚ùå Logout failed', 3000, 'error');
    }
}

// Replace fetchOrders function:
async function fetchOrders(){
    try {
        const {data, error} = await supa.rpc('get_orders');
        
        if(error) throw error;
        
        state.orders = data || [];
        
        if(state.view === 'admin-dashboard') {
            render();
        }
    } catch(err) {
        console.error('Fetch error:', err);
        showToast('‚ùå Failed to load orders', 3000, 'error');
    }
}

// Replace handleOrderButton function:
async function handleOrderButton(){
  const phone = document.getElementById('p-num').value.trim();
  
  const validation = validateGhanaPhone(phone);
  if (!validation.isValid) {
    showToast('‚ùå ' + validation.error, 4000, 'error');
    return;
  }
  
  const {bundle} = state.activeOrderData;
  
  try {
    const ref = 'ORD-' + Math.random().toString(36).slice(2, 10).toUpperCase();
    
    const { data, error } = await supa.rpc('place_order', {
      p_ref: ref,
      p_phone: phone,
      p_network: bundle.network,
      p_bundle_name: bundle.size,
      p_amount: bundle.price,
      p_user_id: state.user.id
    });
    
    if (error) throw error;
    
    if (data && data.success) {
      state.userProfile.balance = data.new_balance;
      showToast('‚úÖ Order placed successfully!', 3000, 'success');
      state.activeOrderData = null;
      navigateTo('success', {
        bundle_name: bundle.size,
        Phone: phone,
        ref: ref
      });
    } else {
      throw new Error(data?.error || 'Failed to place order');
    }
    
  } catch (err) {
    console.error('Order error:', err);
    showToast('‚ùå ' + err.message, 4000, 'error');
  }
}

// Also update fetchAdminStats if you have it, or add this:
async function fetchAdminStats() {
    try {
        const {data, error} = await supa.rpc('get_admin_stats');
        
        if(error) throw error;
        
        if(data && data.length > 0) {
            const stats = data[0];
            // Update your stats display here if needed
            console.log('Admin stats:', stats);
        }
    } catch(err) {
        console.error('Stats error:', err);
    }
}

async function updateStatus(ref, status){
    try {
        const {error} = await supa.from('orders').update({Status:status, updated_at: new Date().toISOString()}).eq('ref',ref);
        if(error) throw error;
        showToast(`‚úÖ Order marked as ${status}`, 3000, 'success');
        fetchOrders();
    } catch(err) {
        showToast('‚ùå Update failed: ' + (err.message || 'Unknown error'), 4000, 'error');
    }
}

async function deleteOrder(ref) {
    // Confirm before deleting
    if (!confirm(`Are you sure you want to delete order ${ref}? This action cannot be undone.`)) {
        return;
    }
    
    try {
        const {error} = await supa.from('orders').delete().eq('ref', ref);
        if(error) throw error;
        showToast(`‚úÖ Order ${ref} deleted successfully`, 3000, 'success');
        fetchOrders();
    } catch(err) {
        showToast('‚ùå Delete failed: ' + (err.message || 'Unknown error'), 4000, 'error');
    }
}

function renderAdminLogin() {
    return `
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="card-theme max-w-md w-full p-8 rounded-3xl shadow-2xl animate-scale-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-slate-700 to-slate-900 rounded-2xl mx-auto mb-4 flex items-center justify-center text-white text-2xl font-black shadow-lg">A</div>
                <h2 class="text-2xl font-black">Admin Access</h2>
                <p class="text-sm text-muted-theme mt-2">Restricted area - Authorized personnel only</p>
            </div>
            
            <form onsubmit="adminAuth(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Email</label>
                    <input type="email" id="adm-u" required class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="admin@example.com">
                </div>
                
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Password</label>
                    <input type="password" id="adm-p" required class="w-full p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" class="w-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 py-4 rounded-2xl font-black text-lg shadow-lg hover:shadow-xl transition-all">
                    Access Dashboard
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button onclick="navigateTo('landing')" class="text-sm text-muted-theme hover:text-blue-600 transition-colors">‚Üê Back to website</button>
            </div>
        </div>
    </div>`;
}

function renderAdminDashboard(){
    const filtered = state.orders.filter(o => {
        const matchesSearch = (o.Phone || '').includes(state.searchQuery) || (o.ref || '').toLowerCase().includes(state.searchQuery.toLowerCase());
        const matchesNetwork = state.networkFilter === 'all' || o.Network === state.networkFilter;
        return matchesSearch && matchesNetwork;
    });
    
    return `
    <div class="animate__animated animate__fadeIn max-w-7xl mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8 animate-slide-up">
            <div>
                <h1 class="text-3xl font-black flex items-center gap-3">
                    <span class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-3 py-1 rounded-lg text-xl">A</span>
                    Admin Dashboard
                </h1>
                <p class="text-sm text-muted-theme mt-1">Manage orders and system settings</p>
            </div>
            <div class="flex gap-3">
                <button onclick="adminLogout()" class="px-4 py-2 rounded-xl font-bold text-sm bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-700 transition-all">
                    Logout
                </button>
            </div>
        </div>
        
        <!-- Mode Switcher -->
        <div class="mb-8 flex flex-wrap gap-4 items-center animate-slide-up stagger-1" style="animation-fill-mode: forwards;">
            <div class="mode-switcher">
                <button class="mode-btn ${state.expressOverride === false ? 'active' : ''}" onclick="switchToNormal()">Normal</button>
                <button class="mode-btn ${state.expressOverride === null ? 'active' : ''}" onclick="resetToAutoMode()">Auto</button>
                <button class="mode-btn ${state.expressOverride === true ? 'active' : ''}" onclick="switchToExpress()">Express</button>
            </div>
            <span class="text-sm text-muted-theme">
                Current: ${isCurrentlyExpress() ? '‚ö° Express Mode (9PM-6AM)' : '‚òÄÔ∏è Normal Mode'}
            </span>
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 animate-slide-up stagger-2" style="animation-fill-mode: forwards;">
            <div class="card-theme p-4 rounded-2xl text-center">
                <div class="text-2xl font-black text-blue-600">${state.orders.length}</div>
                <div class="text-xs font-bold text-muted-theme uppercase">Total Orders</div>
            </div>
            <div class="card-theme p-4 rounded-2xl text-center">
                <div class="text-2xl font-black text-yellow-600">${state.orders.filter(o => o.Status === 'Pending').length}</div>
                <div class="text-xs font-bold text-muted-theme uppercase">Pending</div>
            </div>
            <div class="card-theme p-4 rounded-2xl text-center">
                <div class="text-2xl font-black text-green-600">${state.orders.filter(o => o.Status === 'Completed').length}</div>
                <div class="text-xs font-bold text-muted-theme uppercase">Completed</div>
            </div>
            <div class="card-theme p-4 rounded-2xl text-center">
                <div class="text-2xl font-black text-purple-600">‚Çµ${state.orders.reduce((acc, o) => acc + (parseFloat(o.Amount) || 0), 0).toFixed(2)}</div>
                <div class="text-xs font-bold text-muted-theme uppercase">Revenue</div>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="flex flex-col md:flex-row gap-4 mb-6 animate-slide-up stagger-3" style="animation-fill-mode: forwards;">
            <input type="text" placeholder="Search phone or reference..." 
                   value="${state.searchQuery}" 
                   oninput="state.searchQuery=this.value; render();"
                   class="flex-1 p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all">
            <select onchange="state.networkFilter=this.value; render();" 
                    class="p-4 border-2 dark:bg-slate-800 dark:border-slate-700 rounded-2xl font-bold focus:border-blue-600 outline-none transition-all md:w-48">
                <option value="all">All Networks</option>
                <option value="mtn">MTN</option>
                <option value="airteltigo">AirtelTigo</option>
                <option value="telecel">Telecel</option>
            </select>
        </div>
        
        <!-- Orders Table -->
        <div class="card-theme rounded-2xl overflow-hidden animate-slide-up stagger-4" style="animation-fill-mode: forwards;">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-700">
                        <tr>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Reference</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Phone</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Network</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Bundle</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Amount</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Status</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Date</th>
                            <th class="p-4 text-xs font-black uppercase text-slate-500">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.length === 0 ? `
                        <tr>
                            <td colspan="8" class="p-8 text-center text-muted-theme">No orders found</td>
                        </tr>
                        ` : filtered.map(order => `
                        <tr class="table-row border-b border-slate-200 dark:border-slate-700 last:border-0">
                            <td class="p-4 font-mono text-xs font-bold">${order.ref}</td>
                            <td class="p-4 font-bold">${order.Phone}</td>
                            <td class="p-4">
                                <span class="px-2 py-1 rounded-lg text-xs font-bold ${order.Network === 'mtn' ? 'bg-yellow-100 text-yellow-700' : order.Network === 'airteltigo' ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">
                                    ${order.Network?.toUpperCase()}
                                </span>
                            </td>
                            <td class="p-4 text-sm">${order.bundle_name}</td>
                            <td class="p-4 font-bold">‚Çµ${parseFloat(order.Amount).toFixed(2)}</td>
                            <td class="p-4">
                                <span class="status-badge px-2 py-1 rounded-full text-xs ${order.Status === 'Completed' ? 'bg-green-100 text-green-700' : order.Status === 'Processing' ? 'bg-blue-100 text-blue-700' : 'bg-yellow-100 text-yellow-700'}">
                                    ${order.Status || 'Pending'}
                                </span>
                            </td>
                            <td class="p-4 text-xs text-muted-theme">${new Date(order.created_at).toLocaleDateString()}</td>
                            <td class="p-4">
                                <div class="flex gap-2">
                                    <button onclick="showProcessConfirmation('${order.ref}')" class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-lg font-bold hover:bg-blue-200 transition-colors">
                                        Process
                                    </button>
                                    <button onclick="updateStatus('${order.ref}', 'Completed')" class="text-xs bg-green-100 text-green-700 px-3 py-1 rounded-lg font-bold hover:bg-green-200 transition-colors">
                                        Complete
                                    </button>
                                    <button onclick="deleteOrder('${order.ref}')" class="text-xs bg-red-100 text-red-700 px-3 py-1 rounded-lg font-bold hover:bg-red-200 transition-colors">
                                        Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    </div>`;
}

function showProcessConfirmation(ref) {
    const order = state.orders.find(o => o.ref === ref);
    if (!order) return;
    
    state.currentProcessingOrder = order;
    document.getElementById('confirm-phone').textContent = order.Phone;
    document.getElementById('confirm-network').textContent = order.Network?.toUpperCase();
    document.getElementById('confirm-bundle').textContent = order.bundle_name;
    document.getElementById('confirm-amount').textContent = '‚Çµ' + parseFloat(order.Amount).toFixed(2);
    
    // Reset provider selection
    selectConfirmationProvider('evnetwork');
    
    document.getElementById('admin-order-confirmation').style.display = 'block';
}

function cancelActiveProcess() {
    document.getElementById('admin-actions-bar').style.display = 'none';
    state.isDirectMode = false;
    state.activeOrderData = null;
}

/* ================== SUCCESS VIEW ================== */
function renderSuccessView(params) {
    return `
    <div class="min-h-screen flex items-center justify-center px-4 py-20 animate__animated animate__fadeIn">
        <div class="max-w-md w-full card-theme p-8 md:p-12 rounded-3xl text-center animate-scale-in">
            <div class="w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full mx-auto mb-6 flex items-center justify-center">
                <svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </div>
            
            <h2 class="text-3xl font-black mb-4">Order Confirmed!</h2>
            <p class="text-muted-theme mb-8">Your data bundle has been ordered successfully.</p>
            
            <div class="bg-slate-50 dark:bg-slate-800/50 rounded-2xl p-6 mb-8 text-left space-y-3">
                <div class="flex justify-between">
                    <span class="text-sm text-muted-theme">Reference:</span>
                    <span class="font-bold font-mono text-sm">${params.ref}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm text-muted-theme">Bundle:</span>
                    <span class="font-bold">${params.bundle_name}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm text-muted-theme">Phone:</span>
                    <span class="font-bold">${params.Phone}</span>
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="navigateTo('home')" class="w-full cta-button text-white py-4 rounded-2xl font-black text-lg shadow-lg hover:shadow-xl transition-all">
                    Buy More Data
                </button>
                <button onclick="navigateTo('wallet')" class="w-full bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 py-4 rounded-2xl font-bold hover:bg-slate-200 dark:hover:bg-slate-700 transition-all">
                    View Wallet
                </button>
            </div>
        </div>
    </div>`;
}

/* ================== RENDER CONTROLLER ================== */
function render(){
    const app = document.getElementById('app-view');
    const extended = document.getElementById('extended-content');
    
    updateAuthUI();
    
    // Hide admin actions bar by default
    document.getElementById('admin-actions-bar').style.display = 'none';
    
    switch(state.view){
        case 'landing':
            app.innerHTML = renderLandingPage();
            extended.innerHTML = renderExtendedContent();
            break;
        case 'home':
            app.innerHTML = renderHome();
            extended.innerHTML = renderExtendedContent();
            break;
        case 'network':
            app.innerHTML = renderNetworkView(state.params);
            extended.innerHTML = '';
            break;
        case 'about':
            app.innerHTML = renderAbout();
            extended.innerHTML = '';
            break;
        case 'login':
            app.innerHTML = renderLogin();
            extended.innerHTML = '';
            break;
        case 'register':
            app.innerHTML = renderRegister();
            extended.innerHTML = '';
            break;
        case 'forgot-password':
            app.innerHTML = renderForgotPassword();
            extended.innerHTML = '';
            break;
        case 'wallet':
            app.innerHTML = renderWallet();
            extended.innerHTML = '';
            // Refresh transactions when wallet view is rendered
            if (state.user) {
                fetchUserTransactions();
            }
            break;
        case 'success':
            app.innerHTML = renderSuccessView(state.params);
            extended.innerHTML = '';
            break;
        case 'admin-login':
            app.innerHTML = renderAdminLogin();
            extended.innerHTML = '';
            break;
        case 'admin-dashboard':
            if(!state.isAdmin){
                navigateTo('admin-login');
                return;
            }
            app.innerHTML = renderAdminDashboard();
            extended.innerHTML = '';
            break;
        default:
            navigateTo('landing');
    }
    
    // If there's an active order being processed, show the modal
    if (state.activeOrderData) {
        const modal = document.createElement('div');
        modal.innerHTML = renderOrderForm();
        app.appendChild(modal.firstElementChild);
    }
    
    // Initialize Adsense ads if any
    if (typeof adsbygoogle !== 'undefined') {
        try {
            (adsbygoogle = window.adsbygoogle || []).push({});
        } catch(e) {
            console.log('AdSense not loaded');
        }
    }
}

/* ================== INITIALIZATION ================== */
document.addEventListener('DOMContentLoaded', async () => {
    // Check for existing session
    try {
        const { data: { session }, error: sessionError } = await supa.auth.getSession();
        
        if (sessionError) {
            console.error('Session error:', sessionError);
        }
        
        if (session) {
            state.user = session.user;
            await fetchUserProfile();
        }
    } catch (err) {
        console.error('Initialization error:', err);
        showToast('‚ö†Ô∏è Connection error. Please check your internet connection.', 5000, 'error');
    }
    
    // Setup admin nav button
    document.getElementById('admin-nav-btn').addEventListener('click', () => {
        if (state.isAdmin) {
            navigateTo('admin-dashboard');
        } else {
            navigateTo('admin-login');
        }
    });
    
    // Setup global fulfill button
    document.getElementById('global-fulfill-btn').addEventListener('click', () => {
        if (state.activeOrderData) {
            handleOrderButton();
        }
    });
    
    render();
});

// Handle auth state changes
supa.auth.onAuthStateChange((event, session) => {
    console.log('Auth state changed:', event);
    
    if (event === 'SIGNED_IN') {
        state.user = session.user;
        fetchUserProfile();
    } else if (event === 'SIGNED_OUT') {
        state.user = null;
        state.userProfile = null;
        state.isAdmin = false;
    } else if (event === 'USER_UPDATED') {
        state.user = session.user;
    }
    
    render();
});
</script>
</body>
</html>
